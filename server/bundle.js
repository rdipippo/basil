!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=52)}([function(e,t,n){"use strict";(function(t){var r=n(4),o=n(10),i=n(2),s=n(7),a=n(13);global.rootPath=r.normalize(r.join(t,"..","..")),console.log("process.argv: "+process.argv);var c=void 0;c=process.argv.length>0?process.argv[1]:process.cwd(),global.rootPath=r.normalize(r.join(r.dirname(c),"..")),console.log("Application root path: "+global.rootPath),e.exports={isDevMode:function(){return!1},isProductionMode:function(){return!0},isTestMode:function(){return!1}};var u={},l=r.join(global.rootPath,"config.js");try{if(!o.existsSync(l)){console.warn(s.yellow.bold("External production configuration not found!. Create a default `config.js` file..."));var d=void 0;d=n(54),i.templateSettings.interpolate=/{{([\s\S]+?)}}/g;var f=i.template(d),p={hashSecret:a(),sessionSecret:a()};o.writeFileSync(l,f(p)),console.warn(s.green.bold("The `config.js` file created! Please update the settings in the file!"))}u=n(55)}catch(e){console.warn(s.red.bold("\r\n==============================================")),console.warn(s.red.bold("  Unable to load external `config.js` file!")),console.warn(s.red.bold(" ",e)),console.warn(s.red.bold("==============================================\r\n")),process.exit(1)}var m=n(56),v={};e.exports.isTestMode()?(console.log("Load test config..."),v=n(57),u={}):e.exports.isProductionMode()&&(console.log("Load production config..."),v=n(58)),e.exports=i.defaultsDeep(u,v,m,e.exports)}).call(this,"server\\config")},function(e,t,n){"use strict";var r=n(59),o=n(4),i=n(10),s=n(31),a=n(0),c=[];if(c.push(new r.transports.Console({level:a.logging.console.level,colorize:!0,prettyPrint:!0,handleExceptions:!0})),a.logging.logentries.enabled&&a.logging.logentries.token){console.log("Logentries log transport enabled!");n(60);c.push(new r.transports.Logentries({level:"debug",token:a.logging.logentries.token}))}if(a.logging.papertrail.enabled){console.log("Papertrail log transport enabled!"),n(61).Papertrail;var u=new r.transports.Papertrail(a.logging.papertrail);c.push(u)}if(a.logging.file.enabled){var l=a.logging.file.path;i.existsSync(l)||s(l),c.push(new(n(62))({filename:o.join(l,"server.log"),level:a.logging.file.level||"info",timestamp:!0,json:a.logging.file.json||!1,handleExceptions:!0})),a.logging.file.exceptionFile&&c.push(new r.transports.File({filename:o.join(l,"exceptions.log"),level:"error",timestamp:!0,json:a.logging.file.json||!1,prettyPrint:!0,handleExceptions:!0,humanReadableUnhandledException:!0}))}var d=r.createLogger({level:"debug",transports:c,exitOnError:!1});if(a.logging.loggly.enabled&&a.logging.loggly.token){console.log("Loggly log transport enabled!");n(63);d.add(r.transports.Loggly,{inputToken:a.logging.loggly.token,subdomain:a.logging.loggly.subdomain,tags:["vem-server"],json:!0})}if(a.logging.logsene.enabled&&a.logging.logsene.token){console.log("Logsene log transport enabled!");var f=n(64);d.add(f,{type:"vem-server",token:a.logging.logsene.token})}if(a.logging.logzio.enabled&&a.logging.logzio.token){console.log("Logz.io log transport enabled!");var p=n(65);d.add(p,{token:a.logging.logzio.token})}if(a.logging.graylog.enabled){console.log("Graylog log transport enabled! Servers: "+JSON.stringify(a.logging.graylog.servers));var m=n(66);d.add(m,{name:"Graylog",level:"debug",graylog:{servers:a.logging.graylog.servers,facility:"vem"}})}e.exports=d},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";n(0),n(1);var r=n(5),o=(n(10),n(4),n(2),n(22)),i=n(69),s=(n(17),n(11)),a=s.Schema,c=n(23)("users"),u=n(18),l=function(e){return"local"!==this.provider&&!this.updated||e.length},d=new a({fullName:{type:String,trim:!0,default:"",validate:[l,"Please fill in your full name"]},email:{type:String,trim:!0,unique:!0,index:!0,lowercase:!0,default:"",validate:[l,"Please fill in your email"],match:[/.+\@.+\..+/,"Please fill a valid email address"]},username:{type:String,unique:!0,index:!0,lowercase:!0,required:"Please fill in a username",trim:!0,match:[/^[\w][\w\-\._\@]*[\w]$/,"Please fill a valid username"]},password:{type:String,default:"",validate:[function(e){return"local"!==this.provider||e&&e.length>=6},"Password should be longer"]},passwordLess:{type:Boolean,default:!1},passwordLessToken:{type:String},provider:{type:String,default:"local"},profile:{name:{type:String},gender:{type:String},picture:{type:String},location:{type:String}},socialLinks:{facebook:{type:String,unique:!0,sparse:!0},twitter:{type:String,unique:!0,sparse:!0},google:{type:String,unique:!0,sparse:!0},github:{type:String,unique:!0,sparse:!0}},roles:{type:[{type:String,enum:[r.ROLE_ADMIN,r.ROLE_USER,r.ROLE_GUEST]}],default:[r.ROLE_USER]},resetPasswordToken:String,resetPasswordExpires:Date,verified:{type:Boolean,default:!1},verifyToken:{type:String},apiKey:{type:String,unique:!0,index:!0,sparse:!0},lastLogin:{type:Date},locale:{type:String},status:{type:Number,default:1},metadata:{}},{timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}});d.virtual("code").get((function(){return this.encodeID()})),d.plugin(u.plugin,{model:"User",startAt:1}),d.pre("save",(function(e){var t=this;if(!t.isModified("password"))return e();i.genSalt(10,(function(n,r){i.hash(t.password,r,null,(function(n,r){t.password=r,e()}))}))})),d.methods.comparePassword=function(e,t){i.compare(e,this.password,(function(e,n){t(e,n)}))},d.virtual("avatar").get((function(){return this.profile&&this.profile.picture?this.profile.picture:this.email?"https://gravatar.com/avatar/"+o.createHash("md5").update(this.email).digest("hex")+"?s=64&d=wavatar":"https://gravatar.com/avatar/?s=64&d=wavatar"})),d.methods.encodeID=function(){return c.encodeHex(this._id)},d.methods.decodeID=function(e){return c.decodeHex(e)};var f=s.model("User",d);e.exports=f},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";var r={append:function(e,t){e.forEach((function(e){var n=e.toUpperCase();t&&(n=t+"_"+n),r[n]=e}))}};r.append(["admin","user","guest"],"ROLE"),r.append(["admin","owner","loggedIn","public"],"PERM"),r.append(["VALIDATION_ERROR","INVALID_CODE","MODEL_NOT_FOUND","ONLY_OWNER_CAN_EDIT_AND_DELETE"],"ERR"),e.exports=r},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("chalk")},function(e,t,n){"use strict";(function(t){var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(1),i=(n(0),n(137).EventEmitter),s=n(4),a=(n(10),n(138),n(2)),c=n(7),u=n(20),l=(n(5),n(139)),d=n(12),f=n(14),p=n(141),m=(n(142),n(143).GraphQLScalarType,n(173).Kind),v=n(144);var h=function(e){function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.setMaxListeners(0),e.app=null,e.db=null,e.services={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,e),r(i,[{key:"loadServices",value:function(e,r){var i=this;i.app=e,i.db=r;var u=function(t){var n=new v(t,e,r);i.services[n.name]=n};o.info(""),o.info(c.bold("Search built-in services..."));var d=n(148);d&&d.keys().map((function(e){o.info("  Load",s.relative(s.join(t,"..","services"),e),"service..."),u(d(e))})),o.info(""),o.info(c.bold("Search applogic services..."));var f=n(150);f&&f.keys().map((function(e){o.info("  Load",s.relative(s.join(t,"..","applogic","modules"),e),"service..."),u(f(e))})),a.forIn(i.services,(function(e){a.isFunction(e.$schema.init)&&e.$schema.init.call(e,l.CreateToServiceInit(e))}))}},{key:"registerRoutes",value:function(e){var t=this;a.forIn(this.services,(function(n,r){if(!1!==n.$settings.rest&&n.actions){var i=u.Router();i.use(d.tryAuthenticateWithApiKey);var s=n.$settings.idParamName||"id",c=[];a.forIn(n.actions,(function(r,u){var d=r.settings;if(d.handler=r,!a.isFunction(d.handler))throw new Error("Missing handler function in '"+u+"' action in '"+n.name+"' service!");var p=function(r,i){var s=l.CreateFromREST(n,d,e,r,i);o.debug("Request via REST '"+n.namespace+"/"+d.name+"' (ID: "+s.id+")",s.params),console.time("REST request"),t.emit("request",s);n.getCacheKey(d.name,s.params);Promise.resolve().then((function(){return s.resolveModel()})).then((function(){return s.checkPermission()})).then((function(){return d.handler(s)})).then((function(e){i.append("Request-Id",s.id),f.json(i,e)})).catch((function(e){o.error(e),f.json(i,null,e)})).then((function(){t.emit("response",s),console.timeEnd("REST request")}))};switch(i.get("/"+u,p),i.post("/"+u,p),i.get("/:"+s+"/"+u,p),i.post("/:"+s+"/"+u,p),u){case"find":i.get("/",p);break;case"get":c.push({method:"get",path:"/:"+s,handler:p});break;case"create":c.push({method:"post",path:"/:"+s,handler:p}),i.post("/",p);break;case"update":c.push({method:"put",path:"/:"+s,handler:p}),c.push({method:"patch",path:"/:"+s,handler:p}),i.put("/",p),i.patch("/",p);break;case"remove":c.push({method:"delete",path:"/:"+s,handler:p}),i.delete("/",p)}})),c.forEach((function(e){i[e.method](e.path,e.handler)})),e.use("/api/"+n.namespace,i),n.version&&e.use("/api/v"+n.version+"/"+n.namespace,i)}}))}},{key:"registerSockets",value:function(e,t){var n=this;a.forIn(this.services,(function(r,i){if(!1!==r.ws){r.socket=r.socket||{};var s=void 0;s=r.socket.nsp&&"/"!==r.socket.nsp?t.addNameSpace(r.socket.nsp,r.role):e,r.io=s,s.on("connection",(function(e){a.isFunction(r.socket.afterConnection)&&r.socket.afterConnection.call(r,e,s),a.forIn(r.actions,(function(t,i){var s=t.settings;if(s.handler=t,!a.isFunction(s.handler))throw new Error("Missing handler function in '"+i+"' action in '"+r.name+"' service!");var c="/"+r.namespace+"/"+s.name,u=function(t,i){var c=l.CreateFromSocket(r,s,n.app,e,t);o.debug("Request via WebSocket '"+r.namespace+"/"+s.name+"'",c.params),console.time("SOCKET request"),n.emit("request",c);r.getCacheKey(s.name,c.params);Promise.resolve().then((function(){return c.resolveModel()})).then((function(){return c.checkPermission()})).then((function(){return s.handler(c)})).then((function(e){a.isFunction(i)&&i(f.json(null,e))})).catch((function(e){o.error(e),a.isFunction(i)&&i(f.json(null,null,e))})).then((function(){n.emit("response",c),console.timeEnd("SOCKET request")}))};e.on(c,u),r.version&&e.on("/v"+r.version+c,u)}))}))}}))}},{key:"registerGraphQLSchema",value:function(){var e=this,t={queries:[],types:[],mutations:[],resolvers:[]};if(a.forIn(this.services,(function(n,r){if(!1!==n.$settings.graphql&&a.isObject(n.$schema.graphql)){var i=n.$schema.graphql;i.resolvers=i.resolvers||{};var s=function(t){a.forIn(t,(function(r,i){if(a.isString(r)&&n.actions[r]){t[i]=function(t,s,c){var u=n.actions[r],d=u.settings;if(d.handler=u,!a.isFunction(d.handler))throw new Error("Missing handler function in '"+i+"' action in '"+n.name+"' service!");var f=l.CreateFromGraphQL(n,d,t,s,c);o.debug("Request via GraphQL",f.params,c.query),console.time("GRAPHQL request"),e.emit("request",f);n.getCacheKey(d.name,f.params);return Promise.resolve().then((function(){return f.resolveModel()})).then((function(){return f.checkPermission()})).then((function(){return d.handler(f)})).catch((function(e){throw o.error(e),e})).then((function(t){return e.emit("response",f),console.timeEnd("GRAPHQL request"),t}))}}}))};i.resolvers.Query&&s(i.resolvers.Query),i.resolvers.Mutation&&s(i.resolvers.Mutation),t.queries.push(i.query),t.types.push(i.types),t.mutations.push(i.mutation),t.resolvers.push(i.resolvers)}})),0==t.queries.length)return null;var n;return{schema:["\n\n\t\t\tscalar Timestamp\n\n\t\t\ttype Query {\n\t\t\t\t"+t.queries.join("\n")+"\n\t\t\t}\n\n\t\t\t"+t.types.join("\n")+"\n\n\t\t\ttype Mutation {\n\t\t\t\t"+t.mutations.join("\n")+"\n\t\t\t}\n\n\t\t\tschema {\n\t\t\t\tquery: Query\n\t\t\t\tmutation: Mutation\n\t\t\t}\n\t\t"],resolvers:(n={Timestamp:{__parseValue:function(e){return new Date(e)},__serialize:function(e){return e.getTime()},__parseLiteral:function(e){return e.kind===m.INT?parseInt(e.value,10):null}}},t.resolvers.forEach((function(e){n=a.merge(n,e)})),n)}}},{key:"get",value:function(e){return this.services[e]}},{key:"printServicesInfo",value:function(){p(this.app)}}]),i}(i);e.exports=new h}).call(this,"server\\core")},function(e,t){e.exports=require("querystring")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var r=n(68);r.set("useCreateIndex",!0),e.exports=r},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(6),s=n(3);e.exports.isAuthenticated=function(e,t,n){return e.isAuthenticated()?n():t.sendStatus(401)},e.exports.tryAuthenticateWithApiKey=function(e,t,n){e.isAuthenticated()?n():e.headers.apikey||e.query.apikey||e.body.apikey?i.authenticate("localapikey",(function(t,o,i){o?e.login(o,(function(e){n()})):(r.warn("Apikey error:",i),n())}))(e,t,n):n()},e.exports.isAuthenticatedOrApiKey=function(e,t,n){return e.isAuthenticated()?n():e.headers.apikey||e.query.apikey||e.body.apikey?void i.authenticate("localapikey",(function(r,o,i){return r?t.sendStatus(500):o?void e.login(o,(function(e){return e?t.sendStatus(500):n()})):t.status(401).send(i.message||"")}))(e,t,n):t.sendStatus(401)},e.exports.hasRole=function(t){if(!t)throw new Error("Required role needs to be set");return function(n,r,o){return e.exports.isAuthenticated(n,r,(function(){n.user&&n.user.roles&&-1!==n.user.roles.indexOf(t)?o():r.sendStatus(403)}))}},e.exports.hasAdminRole=function(){return e.exports.hasRole("admin")},e.exports.linkToSocialAccount=function(e){var t=e.req,n=(e.accessToken,e.refreshToken,e.profile),r=e.done,i=e.provider,a=(e.username,e.email),c=e.userData;if(t.user){var u={};u["socialLinks."+i]=n.id,s.findOne(u,(function(e,o){if(o)return o._id!=t.user._id?(t.flash("error",{msg:t.t("SocialIDLinkedToOtherAccount")}),r(e)):r(e,o);s.findById(t.user.id,(function(e,o){o.socialLinks=o.socialLinks||{},o.socialLinks[i]=n.id,o.profile=o.profile||{},o.profile.name=o.profile.name||c.name,o.profile.gender=o.profile.gender||c.gender,o.profile.picture=o.profile.picture||c.picture,o.profile.location=o.profile.location||c.location,o.save((function(e){t.flash("info",{msg:t.t("AccountHasBeenLinked")}),r(e,o)}))}))}))}else{var l={};l["socialLinks."+i]=n.id,s.findOne(l,(function(e,u){return u?1!==u.status?(t.flash("error",{msg:t.t("UserDisabledOrDeleted")}),r()):r(e,u):a?void s.findOne({email:a},(function(e,u){if(u){if(1!==u.status)return t.flash("error",{msg:t.t("UserDisabledOrDeleted")}),r();var l=u;return l.socialLinks=l.socialLinks||{},l.socialLinks[i]=n.id,l.profile=l.profile||{},l.profile.name=l.profile.name||c.name,l.profile.gender=l.profile.gender||c.gender,l.profile.picture=l.profile.picture||c.picture,l.profile.location=l.profile.location||c.location,void l.save((function(e){t.flash("info",{msg:t.t("AccountHasBeenLinked")}),r(e,l)}))}if(!0===o.features.disableSignUp)return t.flash("error",{msg:t.t("SignUpDisabledPleaseLogin")}),r();var d=new s;d.fullName=c.name,d.email=a,d.username=a,d.provider=i,d.verified=!0,d.passwordLess=!0,d.socialLinks={},d.socialLinks[i]=n.id,d.profile=c,d.save((function(e){r(e,d)}))})):(t.flash("error",{msg:t.t("SocialMissingEmailAddress")}),r())}))}}},function(e,t,n){"use strict";var r=n(53),o=new r(256,r.BASE62);e.exports=function(){return o.generate()}},function(e,t,n){"use strict";e.exports={BAD_REQUEST:{status:400,type:"BAD_REQUEST",message:"Invalid request"},UNAUTHORIZED:{status:401,type:"UNAUTHORIZED",message:"Unauthorized. Please login first!"},REQUEST_FAILED:{status:402,type:"REQUEST_FAILED",message:"Request failed!"},FORBIDDEN:{status:403,type:"FORBIDDEN",message:"You have not enough permission for this resource!"},NOT_FOUND:{status:404,type:"NOT_FOUND",message:"Not found!"},TOO_MANY_REQUEST:{status:429,type:"TOO_MANY_REQUEST",message:"Too many request!"},SERVER_ERROR:{status:500,type:"SERVER_ERROR",message:"Server error"},NOT_IMPLEMENTED:{status:501,type:"NOT_IMPLEMENTED",message:"This resource is not implemented!"},json:function(e,t,n,r){var o={};return n?(o.error=n,o.status=n.status||500,r&&(o.error.message=r.message||r),o.data=t,e?e.status(o.status).json(o):o):(o.status=200,o.data=t,e?e.json(o):o)}}},function(e,t,n){"use strict";var r=n(1),o=n(0),i=(n(4),n(10),n(36)),s=n(2),a=n(37),c=n(6),u=n(140),l=n(38),d=n(39)(l),f=void 0,p={IO:null,mongoStore:null,namespaces:{},userSockets:[],init:function(e,t){p.mongoStore=new d({mongooseConnection:t,collection:o.sessions.collection,autoReconnect:!0});var s=i.createServer(e),a=u(s);return e.io=p,p.IO=a,p.initNameSpace("/",a,p.mongoStore),a.on("connection",(function(e){e.on("welcome",(function(t){r.info("Incoming welcome message from "+e.request.user.username+":",t)}))})),n(8).registerSockets(a,p),s},addNameSpace:function(e,t){var n=p.namespaces[e];return null==n&&(n=p.IO.of(e),p.initNameSpace(e,n,p.mongoStore,t)),n},initNameSpace:function(e,t,i,s){t.use((function(t,n){a(o.sessionSecret)(t.request,{},(function(a){var u=t.request.signedCookies?t.request.signedCookies[o.sessions.name]:void 0;if(!u)return r.warn("sessionId was not found in socket.request"),n(new Error("sessionId was not found in socket.request"),!1);i.get(u,(function(o,a){return o?n(o,!1):a?(t.request.session=a,a.socket=t.id,i.set(u,a),void c.initialize()(t.request,{},(function(){c.session()(t.request,{},(function(){if(t.request.user){var o=t.request.user;s?o.roles&&-1!==o.roles.indexOf(s)?n(null,!0):(r.warn("Websocket user has no access to this namespace '"+e+"'!",o.username),n(new Error("You have NO access to this namespace '"+e+"'!"),!1)):n(null,!0)}else r.warn("Websocket user is not authenticated!"),n(new Error("User is not authenticated! Please login first!"),!1)}))}))):n(new Error("session was not found for "+u),!1)}))}))})),t.on("connection",(function(e){f||(f=n(8)),f.emit("socket:connect",e),p.addOnlineUser(e),r.debug("WS client connected to namespace "+(t.name||"root")+"! User: "+e.request.user.username),e.on("disconnect",(function(){f.emit("socket:connect",e),p.removeSocket(e),r.debug("WS client disconnected from namespace "+(t.name||"root")+"!")}))})),p.namespaces[e]=t},nsEmit:function(e,t,n){if(p.namespaces[e])return p.namespaces[e].emit(t,n),!0},addOnlineUser:function(e){p.removeOnlineUser(e),p.userSockets.push(e)},removeSocket:function(e){s.remove(p.userSockets,(function(t){return t==e}))},removeOnlineUser:function(e){s.remove(p.userSockets,(function(t){return t.request.user._id==e.request.user._id}))}};e.exports=p},function(e,t){e.exports=require("moment")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(7),s=n(11),a=n(18);e.exports=function(){return r.info({}),s.Promise=global.Promise,1!==s.connection.readyState?(r.info("Connecting to Mongo "+o.db.uri+"..."),s.connect(o.db.uri,o.db.options,(function(e){if(e)return r.error("Could not connect to MongoDB!"),r.error(e);s.set("debug",o.isDevMode())})),s.connection.on("error",(function(e){return"ETIMEDOUT"===e.message.code?(r.warn("Mongo connection timeout!",e),void setTimeout((function(){s.createConnection(o.db.uri,o.db.options)}),1e3)):(r.error("Could not connect to MongoDB!"),r.error(e))})),a.initialize(s.connection),s.connection.once("open",(function(){r.info(i.yellow.bold("Mongo DB connected.")),r.info({}),o.isTestMode()?(r.warn("Drop test database..."),n(32)()):o.isProduction||n(32)()}))):(r.info("Mongo already connected."),s),s.connection}},function(e,t){e.exports=require("mongoose-auto-increment")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(7),s=n(73),a=void 0;o.redis.enabled&&((a=new s(o.redis.uri)).on("connect",(function(e){r.info(i.green.bold("Redis client connected!"))})),a.on("error",(function(e){r.error(e)})),o.isDevMode()&&a.monitor((function(e,t){r.debug("Redis entering monitoring mode..."),t.on("monitor",(function(e,t,n,o){r.debug("REDIS: ",t)}))}))),e.exports=a},function(e,t){e.exports=require("express")},function(e){e.exports=JSON.parse('{"name":"vue-express-mongo-boilerplate","version":"0.9.0","title":"Vue-Express-Mongo BoilerPlate","description":"Express NodeJS application server boilerplate with Mongo and VueJS","main":"server/index.js","scripts":{"build":"webpack --progress --colors --config build/webpack.prod.config.js","build:server":"webpack --progress --colors --config build/webpack.server.config.js","dev":"cross-env NODE_ENV=development nodemon --inspect","docker-dev":"cross-env NODE_ENV=development MONGO_URI=mongodb://mongo/ nodemon --debug","start":"cross-env NODE_ENV=production node server/index.js","start:bundle":"cross-env NODE_ENV=production node server/bundle.js","start:cluster":"cross-env NODE_ENV=production node cluster.js","test:unit":"cross-env NODE_ENV=test mocha --require babel-core/register --reporter spec tests/unit","test:e2e:nightmare":"cross-env NODE_ENV=test mocha --require babel-core/register --timeout 30000 --reporter spec tests/e2e","test:e2e":"node tests/e2e/runner.js","test":"npm run test:unit && npm run test:e2e","ci":"cross-env NODE_ENV=test nodemon --exec \\"mocha --require babel-core/register --reporter dot --watch tests/unit\\" tests/unit","lint":"eslint --ext=.js,.vue client server","lint:fix":"eslint --fix --ext=.js,.vue client server","typings":"typings install"},"repository":{"type":"git","url":"git@github.com:icebob/vue-express-mongo-boilerplate.git"},"keywords":["boilerplate","express","mongo","vue","mongodb","hackaton","bootstrap","starter"],"config":{"dbName":"boilerplate"},"author":"Icebob","license":"MIT","dependencies":{"agenda":"2.0.1","async":"2.6.1","axios":"0.18.0","bcrypt-nodejs":"0.0.3","body-parser":"1.18.3","chalk":"2.4.1","cli-table2":"0.2.0","clui":"0.3.6","compression":"1.7.3","connect-mongo":"2.0.1","cookie-parser":"1.4.3","cross-env":"5.2.0","csurf":"1.9.0","express":"4.16.3","express-flash":"0.0.2","express-list-endpoints":"3.0.1","express-session":"1.15.6","express-status-monitor":"1.1.5","express-validator":"^5.3.1","fakerator":"0.3.0","glob":"7.1.3","graphql":"0.13.2","graphql-server-express":"1.4.0","graphql-subscriptions":"0.5.8","graphql-tools":"3.1.1","hashids":"1.1.4","helmet":"3.21.1","helmet-crossdomain":"0.3.0","i18next":"11.6.0","i18next-express-middleware":"1.3.2","i18next-node-fs-backend":"2.0.0","ioredis":"4.0.0","le_node":"1.8.0","less":"^3.12.2","lodash":"4.17.10","method-override":"3.0.0","mkdirp":"0.5.1","moment":"2.22.2","mongoose":"5.7.5","mongoose-auto-increment":"5.0.1","morgan":"1.9.1","netjet":"1.3.0","node-sass":"4.9.3","nodemailer":"4.6.8","nodemailer-html-to-text":"3.0.0","nodemailer-mailgun-transport":"1.4.0","nodemailer-sendgrid-transport":"0.2.0","object-hash":"1.3.0","passport":"0.4.0","passport-facebook":"2.1.1","passport-github":"1.1.0","passport-google-oauth":"1.0.0","passport-local":"1.0.0","passport-localapikey-update":"0.6.0","passport-twitter":"1.0.4","pretty-bytes":"5.1.0","pug":"2.0.3","require-webpack-compat":"3.0.0","serve-favicon":"2.5.0","slug":"0.9.2","socket.io":"2.1.1","socket.io-client":"2.1.1","stylus":"^0.54.8","uuid-token-generator":"1.0.0","winston":"3.0.0","winston-daily-rotate-file":"3.3.2","winston-graylog2":"1.0.3","winston-loggly-bulk":"2.0.3","winston-logsene":"1.2.5","winston-logzio":"1.0.8","winston-papertrail":"1.0.5"},"devDependencies":{"apollo-client":"1.2.2","autoprefixer":"9.1.3","babel":"6.23.0","babel-core":"^6.26.3","babel-loader":"^7.1.5","babel-plugin-transform-runtime":"6.23.0","babel-preset-env":"^1.7.0","babel-preset-es2015":"6.24.1","babel-preset-stage-0":"6.24.1","babel-runtime":"6.26.0","chai":"4.1.2","chromedriver":"2.41.0","cross-env":"5.2.0","cross-spawn":"6.0.5","css-loader":"1.0.0","del":"3.0.0","es6-promise":"4.2.4","eslint":"5.4.0","eslint-friendly-formatter":"4.0.1","eslint-loader":"2.1.0","eslint-plugin-html":"4.0.5","file-loader":"2.0.0","graphql-tag":"2.9.2","gulp-babel":"^8.0.0","i18next-browser-languagedetector":"2.2.3","i18next-xhr-backend":"1.5.1","jquery":"3.3.1","json-loader":"0.5.7","marked":"0.5.0","mini-css-extract-plugin":"^0.4.2","mocha":"5.2.0","nightwatch":"0.9.15","nodemon":"^1.11.0","postcss-loader":"2.0.5","precss":"1.4.0","pug-plain-loader":"^1.0.0","raw-loader":"0.5.1","request":"2.81.0","sass-loader":"6.0.5","selenium-server":"3.4.0","sinon":"2.3.1","sinon-chai":"2.10.0","stats-webpack-plugin":"0.6.0","style-loader":"0.18.1","toastr":"2.1.2","typings":"2.1.1","url-loader":"0.5.8","uuid":"3.0.1","vue":"2.5.17","vue-form-generator":"2.1.1","vue-html-loader":"1.2.4","vue-loader":"15.4.1","vue-router":"3.0.1","vue-template-compiler":"2.5.17","vue-websocket":"0.2.2","vuex":"3.0.1","webpack":"^4.17.1","webpack-cli":"^3.1.0","webpack-dev-middleware":"3.2.0","webpack-dev-server":"3.1.7","webpack-hot-middleware":"2.22.3","webpack-merge":"4.1.4"}}')},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";var r=n(70),o=n(0);e.exports=function(e,t){return new r(e+o.hashSecret,t||10)}},function(e,t){e.exports=require("webpack")},function(e,t,n){const r=n(9),o=n(106),i="vue-loader-plugin",s="vue-loader";class a{apply(e){e.hooks?e.hooks.compilation.tap(i,e=>{e.hooks.normalModuleLoader.tap(i,e=>{e[s]=!0})}):e.plugin("compilation",e=>{e.plugin("normal-module-loader",e=>{e[s]=!0})});const t=e.options.module.rules,{rules:n}=new o(t);let a=t.findIndex(c("foo.vue"));a<0&&(a=t.findIndex(c("foo.vue.html")));const l=n[a];if(!l)throw new Error("[VueLoaderPlugin Error] No matching rule for .vue files found.\nMake sure there is at least one root-level rule that matches .vue or .vue.html files.");if(l.oneOf)throw new Error("[VueLoaderPlugin Error] vue-loader 15 currently does not support vue rules with oneOf.");const d=l.use,f=d.findIndex(e=>/^vue-loader|(\/|\\|@)vue-loader/.test(e.loader));if(f<0)throw new Error("[VueLoaderPlugin Error] No matching use for vue-loader is found.\nMake sure the rule matching .vue files include vue-loader in its use.");const p=d[f];p.ident="vue-loader-options",p.options=p.options||{};const m=n.filter(e=>e!==l).map(u),v={loader:107,resourceQuery:e=>null!=r.parse(e.slice(1)).vue,options:{cacheDirectory:p.options.cacheDirectory,cacheIdentifier:p.options.cacheIdentifier}};e.options.module.rules=[v,...m,...n]}}function c(e){return(t,n)=>{const r=Object.assign({},t);delete r.include;const i=o.normalizeRule(r,{},"");return!t.enforce&&i.resource&&i.resource(e)}}function u(e){const{resource:t,resourceQuery:n}=e;let o;const i=Object.assign({},e,{resource:{test:e=>(o=e,!0)},resourceQuery:e=>{const i=r.parse(e.slice(1));if(null==i.vue)return!1;if(t&&null==i.lang)return!1;const s=`${o}.${i.lang}`;return!(t&&!t(s))&&!(n&&!n(e))}});return e.oneOf&&(i.oneOf=e.oneOf.map(u)),i}a.NS=s,e.exports=a},function(e,t){e.exports=require("loader-utils")},function(e,t){e.exports=require("hash-sum")},function(e,t,n){const r=n(9),o=["id","index","src","type"];t.attrsToQuery=(e,t)=>{let n="";for(const t in e){const i=e[t];o.includes(t)||(n+=`&${r.escape(t)}=${i?r.escape(i):""}`)}return t&&!("lang"in e)&&(n+="&lang="+t),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(110);t.parse=r.parse;const o=n(113);t.compileTemplate=o.compileTemplate;const i=n(120);t.compileStyle=i.compileStyle,t.compileStyleAsync=i.compileStyleAsync},function(e,t){e.exports=require("postcss")},function(e,t){e.exports=require("mkdirp")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(5),s=n(2),a=n(13),c=n(33)(),u=n(3);e.exports=function(){return u.find({}).exec().then((function(e){if(0===e.length){r.warn("Load default Users to DB...");var t=[],n=new u({fullName:"Administrator",email:"admin@boilerplate-app.com",username:"admin",password:"admin1234",provider:"local",roles:[i.ROLE_ADMIN,i.ROLE_USER],verified:!0});t.push(n.save());var l=new u({fullName:"Test User",email:"test@boilerplate-app.com",username:"test",password:"test1234",provider:"local",roles:[i.ROLE_USER],verified:!0,apiKey:a()});return t.push(l.save()),Promise.all(t).then((function(){if(!o.isProductionMode())return Promise.all(s.times(10,(function(){var e=c.entity.user(),n=new u({fullName:e.firstName+" "+e.lastName,email:e.email,username:e.userName,password:e.password,provider:"local",roles:[i.ROLE_USER],verified:!0});t.push(n.save())})))})).then((function(){r.warn("Default users created!")}))}})).catch((function(e){r.error(e)})).then((function(){return n(71)()})).then((function(){r.debug("Seeding done!")}))}},function(e,t){e.exports=require("fakerator")},function(e,t,n){"use strict";n(0),n(1),n(17);var r=n(11),o=r.Schema,i=n(23)("devices"),s=n(18),a=new o({address:{type:String,trim:!0},type:{type:String,trim:!0},name:{type:String,trim:!0},description:{type:String,trim:!0,default:""},status:{type:Number,default:1},lastCommunication:{type:Date,default:Date.now},metadata:{}},{timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}});a.virtual("code").get((function(){return this.encodeID()})),a.plugin(s.plugin,{model:"Device",startAt:1}),a.methods.encodeID=function(){return i.encodeHex(this._id)},a.methods.decodeID=function(e){return i.decodeHex(e)};var c=r.model("Device",a);e.exports=c},function(e,t,n){"use strict";n(0),n(1),n(2),n(17);var r=n(11),o=r.Schema,i=n(23)("posts"),s=n(18),a=new o({title:{type:String,trim:!0},content:{type:String,trim:!0},author:{type:Number,required:"Please fill in an author ID",ref:"User"},views:{type:Number,default:0},voters:[{type:Number,ref:"User"}],votes:{type:Number,default:0},editedAt:{type:Date},metadata:{}},{timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}});a.virtual("code").get((function(){return this.encodeID()})),a.plugin(s.plugin,{model:"Post",startAt:1}),a.methods.encodeID=function(){return i.encodeHex(this._id)},a.methods.decodeID=function(e){return i.decodeHex(e)};var c=r.model("Post",a);e.exports=c},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("connect-mongo")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(115);t.urlToRequire=function(e){const t=`"${e}"`,n=e.charAt(0);if("."===n||"~"===n||"@"===n){if("~"===n){const t=e.charAt(1);e=e.slice("/"===t?2:1)}const t=function(e){const t=r.parse("");if(e&&"string"==typeof e)return r.parse(e);return t}(e);return t.hash?`require("${t.path}") + "${t.hash}"`:`require("${e}")`}return t}},function(e,t){e.exports=require("vue-hot-reload-api")},function(e,t){e.exports=require("vue-template-compiler")},function(e,t){e.exports=require("object-hash")},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("nodemailer-html-to-text")},function(e,t){e.exports=require("nodemailer-mailgun-transport")},function(e,t){e.exports=require("nodemailer-sendgrid-transport")},function(e,t){e.exports=require("async")},function(e,t,n){"use strict";var r=n(0),o=n(1),i=n(44),s=n(45).htmlToText;e.exports={send:function(e,t,a,c){o.info("Sending email to "+e+" with subject "+t+"..."),o.debug("Deprecated! libs/mailer is deprecated. Use Service.get('mailer') instead!");var u={};e instanceof Object?e instanceof Array?u.to=e:u=e:u.to=e;var l={from:r.mailer.from,to:u.to,cc:u.cc,bcc:u.bcc,subject:t,html:a},d=void 0;if("smtp"==r.mailer.transport)d=i.createTransport(r.mailer.smtp);else if("mailgun"==r.mailer.transport){var f=n(46);d=i.createTransport(f({auth:{api_key:r.mailer.mailgun.apiKey,domain:r.mailer.mailgun.domain}}))}else if("sendgrid"==r.mailer.transport){var p=n(47);d=i.createTransport(p({auth:{api_key:r.mailer.sendgrid.apiKey}}))}d?(d.use("compile",s()),d.sendMail(l,(function(e,t){e?o.warn("Unable to send email: ",e):o.info("Email message sent.",t.response),c&&c(e,t)}))):o.warn("Unable to send email! Invalid mailer transport: "+r.mailer.transport)}}},function(e,t){e.exports=require("graphql-server-express")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(16),s=n(7),a=n(167),c=n(3),u=new a({db:{address:o.db.uri,collection:"agendaJobs"},processEvery:o.agendaTimer||"one minute"});u.on("fail",(function(e,t){return r.error("Job failed with error: "+e.message)})),u.define("removeUnverifiedAccounts",(function(e,t){r.debug("Running 'removeUnverifiedAccounts' process...");try{c.remove({createdAt:{$lte:i().subtract(1,"day").toDate()},verified:!1},(function(e,n){n>0&&r.warn(s.bold.red(n+" unverified and expired account removed!")),t()}))}catch(e){return r.error("Job running exception!"),r.error(e),t(e)}})),u.on("ready",(function(){o.isTestMode()||(u.every("8 hours","removeUnverifiedAccounts"),u.start(),r.info(s.yellow("Agenda started!")))})),e.exports=u},function(e,t,n){"use strict";global.WEBPACK_BUNDLE=!1;var r=n(0),o=n(1),i=n(16),s=n(7);o.info({}),o.info(s.bold("---------------------[ Server starting at %s ]---------------------------"),i().format("YYYY-MM-DD HH:mm:ss.SSS")),o.info({}),o.info(s.bold("Application root path: ")+global.rootPath);n(67);var a=n(17)(),c=n(72)(a);n(51);n(168),c.listen(r.port,r.ip,(function(){o.info(""),o.info(r.app.title+" v"+r.app.version+" application started!"),o.info("----------------------------------------------"),o.info("Environment:\t"+s.underline.bold("production")),o.info("IP:\t\t"+r.ip),o.info("Port:\t\t"+r.port),o.info("Database:\t\t"+r.db.uri),o.info("Redis:\t\t"+(r.redis.enabled?r.redis.uri:"Disabled")),o.info(""),n(169)(),o.info("----------------------------------------------");var e=n(8);r.isDevMode&&e.printServicesInfo()})),e.exports=c},function(e,t){e.exports=require("uuid-token-generator")},function(e,t){e.exports='"use strict";\n\nvar path = require("path");\nvar pkg = require("./package.json");\n\nmodule.exports = {\n\thashSecret: "{{hashSecret}}",\n\n\tsessionSecret: "{{sessionSecret}}",\n\n\tapp: {},\n\n\tdb: {\n\t\toptions: {\n\t\t\tuser: process.env.MONGO_USERNAME || "",\n\t\t\tpass: process.env.MONGO_PASSWORD || "",\n\t\t\tuseNewUrlParser: true\n\t\t}\n\t},\n\n\tredis: {\n\t\tenabled: false,\n\t\turi: process.env.REDIS_URI || "redis://localhost:6379",\n\t\toptions: null\n\t},\n\n\tmailer: {},\n\n\tfeatures: {\n\t\tdisableSignUp: false,\n\t\tverificationRequired: true\n\t},\n\n\tauthKeys: {\n\n\t\tgoogle: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t},\n\n\t\tfacebook: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t},\n\n\t\tgithub: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t},\n\n\t\ttwitter: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t}\n\t},\n\n\tlogging: {\n\n\t\tconsole: {},\n\n\t\tfile: {\n\t\t\tenabled: false\n\t\t},\n\n\t\tgraylog: {\n\t\t\tenabled: false\n\t\t},\n\n\t\tpapertrail: {\n\t\t\tenabled: false,\n\t\t\thost: null,\n\t\t\tport: null,\n\t\t\tlevel: "debug",\n\t\t\tprogram: "vem"\n\t\t},\n\n\t\tlogentries: {\n\t\t\tenabled: false,\n\t\t\ttoken: null\n\t\t},\n\n\t\tloggly: {\n\t\t\tenabled: false,\n\t\t\ttoken: null,\n\t\t\tsubdomain: null\n\t\t},\n\n\t\tlogsene: {\n\t\t\tenabled: false,\n\t\t\ttoken: null\n\t\t},\n\n\t\tlogzio: {\n\t\t\tenabled: false,\n\t\t\ttoken: null\n\t\t}\n\n\t}\n\n};'},function(e,t){e.exports=require("../config.js")},function(e,t,n){"use strict";var r=n(4),o=n(21);e.exports={app:{title:o.title,version:o.version,description:o.description,keywords:o.keywords.join(","),url:"http://localhost:"+(process.env.PORT||3e3)+"/",contactEmail:"hello@vem-app.com"},ip:process.env.NODE_IP||"0.0.0.0",port:process.env.PORT||3e3,rootPath:global.rootPath,dataFolder:r.join(global.rootPath,"data"),uploadLimit:2097152,sessions:{cookie:{maxAge:6048e5,httpOnly:!0,secure:!1},name:"sessionId",collection:"sessions"},test:!1,db:{uri:process.env.MONGO_URI||"mongodb://localhost/"+o.config.dbName+"-dev",options:{user:"",pass:"",keepAlive:1,useNewUrlParser:!0}},redis:{enabled:!1,uri:process.env.REDIS_URI||"redis://localhost:6379",options:null},cacheTimeout:300,mailer:{enabled:!1,from:"noreply@vem-app.com"},features:{disableSignUp:!1,verificationRequired:!0},authKeys:{google:{clientID:null,clientSecret:null},facebook:{clientID:null,clientSecret:null},github:{clientID:null,clientSecret:null},twitter:{clientID:null,clientSecret:null}},logging:{console:{level:"debug"},file:{enabled:!1,path:r.join(global.rootPath,"logs"),level:"info",json:!1,exceptionFile:!0},graylog:{enabled:!1},papertrail:{enabled:!1,host:null,port:null,level:"debug",program:"vem"},logentries:{enabled:!1,token:null},loggly:{enabled:!1,token:null,subdomain:null},logsene:{enabled:!1,token:null},logzio:{enabled:!1,token:null}},agendaTimer:"one minute"}},function(e,t,n){"use strict";var r=n(21);e.exports={app:{title:r.name+" [Test mode]"},hashSecret:"71IIYMzMb0egTaCvvdijhUajAOjsrurzyRX5ziskMk4",sessionSecret:"MB9x-hOkx-UdcCbOprxggu-Wv1PetuoqzBny1h8DULA",mailer:{from:"noreply@vem-app.com",transport:"smtp",smtp:{host:"mailtrap.io",port:2525,auth:{user:"367335eaa82697636",pass:"e5a76af9b056d0"}}},test:!0,db:{uri:"mongodb://localhost/"+r.config.dbName+"-test",options:{user:"",pass:""}}}},function(e,t,n){"use strict";var r=n(21);e.exports={app:{},db:{uri:process.env.MONGO_URI||"mongodb://localhost/"+r.config.dbName,options:{user:process.env.MONGO_USERNAME||"",pass:process.env.MONGO_PASSWORD||""}}}},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("le_node")},function(e,t){e.exports=require("winston-papertrail")},function(e,t){e.exports=require("winston-daily-rotate-file")},function(e,t){e.exports=require("winston-loggly-bulk")},function(e,t){e.exports=require("winston-logsene")},function(e,t){e.exports=require("winston-logzio")},function(e,t){e.exports=require("winston-graylog2")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(10),s=n(31);i.existsSync(o.dataFolder)||s.sync(o.dataFolder),o.isProductionMode()||(r.info("Loaded configuration:"),r.info(o),r.info({}))},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("bcrypt-nodejs")},function(e,t){e.exports=require("hashids")},function(e,t,n){"use strict";var r=n(1),o=(n(0),n(2)),i=(n(13),n(33)()),s=n(3),a=n(34),c=n(35);e.exports=function(){var e=a.find({}).exec().then((function(e){0===e.length&&(r.warn("Load default Devices to DB..."),o.times(36,(function(){return new a({address:i.internet.ip(),type:i.random.arrayElement(["rasperry","odroid","nanopi","pc"]),name:i.populate("#{names.firstName}'s device"),description:i.lorem.sentence(),status:i.random.boolean("80")?1:0,lastCommunication:Date.now()}).save().then((function(){r.info("Default devices created!")}))})))})),t=c.find({}).exec((function(e,t){0===t.length&&(r.warn("Load default Posts to DB..."),s.find({}).lean().select("_id").exec((function(e,t){t&&t.length>0&&o.times(60,(function(){var e=i.entity.post(i.random.number(2,1));return new c({title:e.title,content:e.content,author:i.random.arrayElement(t)._id}).save().then((function(){r.info("Default posts created!")}))}))})))}));return Promise.all([e,t])}},function(e,t,n){"use strict";var r=n(1),o=n(0),i=(n(19),n(20)),s=(n(36),n(4)),a=n(16),c=n(74),u=n(75),l=n(76),d=n(77),f=n(37),p=n(78),m=(n(79),n(80)),v=n(38),h=n(81),g=n(82),y=n(83),E=n(84),b=(n(11),n(39)(v)),k=n(85),w=n(86),S=n(87),O=s.normalize(s.join(o.rootPath,"server"));e.exports=function(e){var t=i();!function(e){e.locals.app=o.app,e.use((function(e,t,n){return t.locals.url=e.protocol+"://"+e.headers.host+e.url,n()})),e.locals.year=a().format("YYYY"),e.locals.features=o.features}(t),function(e){if(e.use(h({filter:function(e,t){return/json|text|javascript|css/.test(t.getHeader("Content-Type"))},level:3,threshold:512})),e.set("port",o.port),e.use(d.urlencoded({extended:!0,limit:2*o.contentMaxLength})),e.use(p()),e.use(d.json()),e.use(g()),o.isProductionMode()&&(e.use(m({cache:{max:100}})),e.use(i.static(s.join(O,"public")))),e.use(u(s.join(O,"public","favicon.ico"))),e.use(f()),e.set("etag",!0),e.use(c()),o.isDevMode()){var t=new(n(88).Stream);t.writable=!0,t.write=function(e){return r.debug(e)},e.use(l("dev",{stream:t}))}}(t),function(e){e.set("views",s.join(O,"views")),e.set("view engine","pug"),o.isDevMode()?(e.set("showStackError",!0),e.set("view cache",!1),e.use(y.noCache()),e.locals.pretty=!0):(e.locals.cache="memory",e.set("view cache",!0))}(t),function(e){e.use(y.xssFilter()),e.use(y.noSniff()),e.use(y.frameguard()),e.use(y.ieNoOpen()),e.use(E()),e.use(y.hidePoweredBy())}(t),function(e){var t={fallbackLng:"en",whitelist:["en","hu"],ns:["app","frontend"],defaultNS:"frontend",load:"all",saveMissing:!0,saveMissingTo:"all",backend:{loadPath:s.join(O,"locales","{{lng}}","{{ns}}.json"),addPath:s.join(O,"locales","{{lng}}","{{ns}}.missing.json"),jsonIndent:4}};o.isTestMode()&&(t.whitelist=["en"]),k.use(S).use(w.LanguageDetector).init(t,(function(t,n){e.t=n,t&&r.warn(t)})),k.on("failedLoading",(function(e,t,n){console.log("failedLoading",e,t,n)})),e.use(w.handle(k)),e.get("/locales/resources.json",w.getResourcesHandler(k)),e.post("/locales/add/:lng/:ns",w.missingKeyHandler(k))}(t),function(e,t){e.use(v({saveUninitialized:!0,resave:!1,secret:o.sessionSecret,store:new b({mongooseConnection:t,collection:o.sessions.collection,autoReconnect:!0}),cookie:o.sessions.cookie,name:o.sessions.name}))}(t,e),function(e){n(89)(e),o.isTestMode()}(t),function(e){if(!o.isProductionMode()){var t=n(24),i=n(103),s=t(i),a=n(135);e.use(a(s,{noInfo:!0,publicPath:i.output.publicPath,headers:{"Access-Control-Allow-Origin":"*"},stats:{colors:!0}}));var c=n(136);e.use(c(s,{log:r.info}))}}(t),n(8).loadServices(t,e);var N=n(15).init(t,e);return N._app=t,n(160)(t,e),N}},function(e,t){e.exports=require("ioredis")},function(e,t){e.exports=require("express-flash")},function(e,t){e.exports=require("serve-favicon")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("express-validator")},function(e,t){e.exports=require("csurf")},function(e,t){e.exports=require("netjet")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("method-override")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("helmet-crossdomain")},function(e,t){e.exports=require("i18next")},function(e,t){e.exports=require("i18next-express-middleware")},function(e,t){e.exports=require("i18next-node-fs-backend")},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";var r=n(1),o=(n(0),n(6)),i=n(4),s=n(7);var a=n(3);e.exports=function(e){e.use(o.initialize()),e.use(o.session()),o.serializeUser((function(e,t){return t(null,e.id)})),o.deserializeUser((function(e,t){a.findOne({_id:e},"-password",(function(e,n){return e?t(e):n&&1===n.status?t(null,n):t(null,!1)}))})),r.info(""),r.info(s.bold("Search passport strategies..."));var t;(t=n(90)).keys().map((function(e){r.info("  Loading passport strategy file "+i.basename(e)+"...");var n=t(e);return n(),n}))}},function(e,t,n){var r={"./apikey.js":91,"./facebook.js":93,"./github.js":95,"./google.js":97,"./local.js":99,"./twitter.js":101};function o(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=90},function(e,t,n){"use strict";var r=n(6),o=n(92).Strategy,i=n(3);e.exports=function(){r.use(new o({passReqToCallback:!0},(function(e,t,n){return i.findOne({apiKey:t},(function(t,r){return t?n(t):r?r.verified?1!==r.status?n(null,!1,{message:e.t("UserDisabledOrDeleted")}):n(null,r):n(null,!1,{message:e.t("PleaseActivateAccount")}):n(null,!1,{message:e.t("UnknowAPIKey")})}))})))}},function(e,t){e.exports=require("passport-localapikey-update")},function(e,t,n){"use strict";n(1);var r=n(0),o=n(12),i=n(6),s=n(94).Strategy;n(3);e.exports=function(){r.authKeys.facebook.clientID&&r.authKeys.facebook.clientSecret&&i.use("facebook",new s({clientID:r.authKeys.facebook.clientID,clientSecret:r.authKeys.facebook.clientSecret,callbackURL:"/auth/facebook/callback",profileFields:["name","email","link","locale","timezone"],passReqToCallback:!0},(function(e,t,n,r,i){o.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:r,done:i,provider:"facebook",email:r._json.email,userData:{name:r.name.givenName+" "+r.name.familyName,gender:r._json.gender,picture:"https://graph.facebook.com/"+r.id+"/picture?type=large",location:r._json.location?r._json.location.name:null}})})))}},function(e,t){e.exports=require("passport-facebook")},function(e,t,n){"use strict";var r=n(1),o=n(0),i=n(12),s=n(6),a=n(96).Strategy;n(3);e.exports=function(){o.authKeys.github.clientID&&o.authKeys.github.clientSecret&&s.use("github",new a({clientID:o.authKeys.github.clientID,clientSecret:o.authKeys.github.clientSecret,callbackURL:"/auth/github/callback",scope:["user:email"],passReqToCallback:!0},(function(e,t,n,o,s){r.info("Received profile: ",o);var a=void 0;o.emails&&o.emails.length>0&&((a=o.emails.find((function(e){return e.primary})))||(a=o.emails[0])),i.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:o,done:s,provider:"github",username:o.username,email:a?a.value:null,userData:{name:o.displayName,gender:null,picture:o._json.avatar_url,location:o._json.location}})})))}},function(e,t){e.exports=require("passport-github")},function(e,t,n){"use strict";n(1);var r=n(0),o=n(12),i=n(6),s=n(98).OAuth2Strategy;n(3);e.exports=function(){r.authKeys.google.clientID&&r.authKeys.google.clientSecret&&i.use("google",new s({clientID:r.authKeys.google.clientID,clientSecret:r.authKeys.google.clientSecret,callbackURL:"/auth/google/callback",passReqToCallback:!0},(function(e,t,n,r,i){o.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:r,done:i,provider:"google",email:r.emails[0].value,userData:{name:r.displayName,gender:r.gender,picture:r.photos&&r.photos.length>0?r.photos[0].value.replace("sz=50","sz=200"):null,location:null}})})))}},function(e,t){e.exports=require("passport-google-oauth")},function(e,t,n){"use strict";var r=n(6),o=n(100).Strategy,i=n(3);e.exports=function(){r.use(new o({usernameField:"username",passwordField:"password",passReqToCallback:!0},(function(e,t,n,r){return i.findOne({$or:[{username:t},{email:t}]},(function(t,o){return t?r(t):o?o.verified?1!==o.status?r(null,!1,{message:e.t("UserDisabledOrDeleted")}):o.passwordLess?r(null,!1,{message:e.t("PasswordlessAccountLeaveEmpty")}):void o.comparePassword(n,(function(t,n){return t?r(t):!0!==n?r(null,!1,{message:e.t("InvalidPassword")}):r(null,o)})):r(null,!1,{message:e.t("PleaseActivateAccount")}):r(null,!1,{message:e.t("UnknowUsernameOrEmail")})}))})))}},function(e,t){e.exports=require("passport-local")},function(e,t,n){"use strict";n(1);var r=n(0),o=n(12),i=n(6),s=n(102).Strategy;n(3);e.exports=function(){r.authKeys.twitter.clientID&&r.authKeys.twitter.clientSecret&&i.use("twitter",new s({consumerKey:r.authKeys.twitter.clientID,consumerSecret:r.authKeys.twitter.clientSecret,callbackURL:"/auth/twitter/callback",passReqToCallback:!0},(function(e,t,n,r,i){o.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:r,done:i,provider:"twitter",email:r.username+"@twitter.com",username:r.username,userData:{name:r.displayName,gender:null,picture:r._json.profile_image_url_https,location:r._json.location}})})))}},function(e,t){e.exports=require("passport-twitter")},function(e,t,n){"use strict";n(4);var r=n(24),o=n(104),i=n(105);i.entry.app.unshift("webpack-hot-middleware/client"),i.entry.frontend.unshift("webpack-hot-middleware/client"),e.exports=o(i,{mode:"none",devtool:"#inline-source-map",module:{rules:[{test:/\.scss$/,loaders:["style-loader","css-loader","postcss-loader","sass-loader"]},{test:/\.vue$/,loader:"vue-loader"},{test:/\.pug$/,loader:"pug-plain-loader"}]},performance:{hints:!1},plugins:[new r.HotModuleReplacementPlugin,new r.NoEmitOnErrorsPlugin]})},function(e,t){e.exports=require("webpack-merge")},function(e,t,n){"use strict";(function(t){var r=n(4),o=(n(24),n(25));e.exports={devtool:"#inline-source-map",entry:{app:["./client/app/main.js"],vendor:["es6-promise","vue","vue-router","vuex","lodash","moment","jquery","axios","toastr","vue-form-generator","vue-websocket","apollo-client","graphql-tag","i18next"],frontend:["./client/frontend/main.js"]},output:{path:r.resolve(t,"..","server","public","app"),publicPath:"/app/",filename:"[name].js",chunkFilename:"[chunkhash].js"},module:{noParse:/es6-promise\.js$/,rules:[{test:/\.css$/,loaders:["style-loader","css-loader"]},{test:/\.js$/,loader:"babel-loader",exclude:[/node_modules/,/vendor/]},{test:/\.gif$/,loader:"url-loader",options:{name:"images/[name]-[hash:6].[ext]",limit:1e4}},{test:/\.png$/,loader:"url-loader",options:{name:"images/[name]-[hash:6].[ext]",limit:1e4}},{test:/\.jpg$/,loader:"file-loader",options:{name:"images/[name]-[hash:6].[ext]"}},{test:/\.(woff2?|svg)$/,loader:"url-loader",options:{limit:1e4,prefix:"font/"}},{test:/\.(ttf|eot)$/,loader:"file-loader",options:{prefix:"font/"}}]},resolve:{extensions:[".vue",".js",".json"],mainFiles:["index"],alias:{images:r.resolve(t,"..","client","images"),vue$:"vue/dist/vue.common.js"}},performance:{hints:!1},plugins:[new o]}}).call(this,"build")},function(e,t,n){"use strict";const r=e=>t=>{for(let n=0;n<e.length;n++)if(!e[n](t))return!1;return!0};e.exports=class e{constructor(t){this.references=Object.create(null),this.rules=e.normalizeRules(t,this.references,"ref-")}static normalizeRules(t,n,r){return Array.isArray(t)?t.map((t,o)=>e.normalizeRule(t,n,`${r}-${o}`)):t?[e.normalizeRule(t,n,r)]:[]}static normalizeRule(t,n,r){if("string"==typeof t)return{use:[{loader:t}]};if(!t)throw new Error("Unexcepted null when object was expected as rule");if("object"!=typeof t)throw new Error("Unexcepted "+typeof t+" when object was expected as rule ("+t+")");const o={};let i,s,a;const c=n=>{if(i&&i!==n)throw new Error(e.buildErrorMessage(t,new Error("Rule can only have one result source (provided "+n+" and "+i+")")));i=n},u=n=>{if(s&&s!==n)throw new Error(e.buildErrorMessage(t,new Error("Rule can only have one resource source (provided "+n+" and "+s+")")));s=n};if(t.test||t.include||t.exclude){u("test + include + exclude"),a={test:t.test,include:t.include,exclude:t.exclude};try{o.resource=e.normalizeCondition(a)}catch(t){throw new Error(e.buildErrorMessage(a,t))}}if(t.resource){u("resource");try{o.resource=e.normalizeCondition(t.resource)}catch(n){throw new Error(e.buildErrorMessage(t.resource,n))}}if(t.realResource)try{o.realResource=e.normalizeCondition(t.realResource)}catch(n){throw new Error(e.buildErrorMessage(t.realResource,n))}if(t.resourceQuery)try{o.resourceQuery=e.normalizeCondition(t.resourceQuery)}catch(n){throw new Error(e.buildErrorMessage(t.resourceQuery,n))}if(t.compiler)try{o.compiler=e.normalizeCondition(t.compiler)}catch(n){throw new Error(e.buildErrorMessage(t.compiler,n))}if(t.issuer)try{o.issuer=e.normalizeCondition(t.issuer)}catch(n){throw new Error(e.buildErrorMessage(t.issuer,n))}if(t.loader&&t.loaders)throw new Error(e.buildErrorMessage(t,new Error("Provided loader and loaders for rule (use only one of them)")));const l=t.loaders||t.loader;if("string"!=typeof l||t.options||t.query)if("string"==typeof l&&(t.options||t.query))c("loader + options/query"),o.use=e.normalizeUse({loader:l,options:t.options,query:t.query},r);else{if(l&&(t.options||t.query))throw new Error(e.buildErrorMessage(t,new Error("options/query cannot be used with loaders (use options for each array item)")));if(l)c("loaders"),o.use=e.normalizeUse(l,r);else if(t.options||t.query)throw new Error(e.buildErrorMessage(t,new Error("options/query provided without loader (use loader + options)")))}else c("loader"),o.use=e.normalizeUse(l.split("!"),r);t.use&&(c("use"),o.use=e.normalizeUse(t.use,r)),t.rules&&(o.rules=e.normalizeRules(t.rules,n,r+"-rules")),t.oneOf&&(o.oneOf=e.normalizeRules(t.oneOf,n,r+"-oneOf"));const d=Object.keys(t).filter(e=>!["resource","resourceQuery","compiler","test","include","exclude","issuer","loader","options","query","loaders","use","rules","oneOf"].includes(e));for(const e of d)o[e]=t[e];if(Array.isArray(o.use))for(const e of o.use)e.ident&&(n[e.ident]=e.options);return o}static buildErrorMessage(e,t){const n=JSON.stringify(e,(e,t)=>void 0===t?"undefined":t,2);return t.message+" in "+n}static normalizeUse(t,n){return"function"==typeof t?r=>e.normalizeUse(t(r),n):Array.isArray(t)?t.map((t,r)=>e.normalizeUse(t,`${n}-${r}`)).reduce((e,t)=>e.concat(t),[]):[e.normalizeUseItem(t,n)]}static normalizeUseItemString(e){const t=e.indexOf("?");return t>=0?{loader:e.substr(0,t),options:e.substr(t+1)}:{loader:e,options:void 0}}static normalizeUseItem(t,n){if("string"==typeof t)return e.normalizeUseItemString(t);const r={};if(t.options&&t.query)throw new Error("Provided options and query in use");if(!t.loader)throw new Error("No loader specified");r.options=t.options||t.query,"object"==typeof r.options&&r.options&&(r.options.ident?r.ident=r.options.ident:r.ident=n);const o=Object.keys(t).filter((function(e){return!["options","query"].includes(e)}));for(const e of o)r[e]=t[e];return r}static normalizeCondition(t){if(!t)throw new Error("Expected condition but got falsy value");if("string"==typeof t)return e=>0===e.indexOf(t);if("function"==typeof t)return t;if(t instanceof RegExp)return t.test.bind(t);if(Array.isArray(t)){return(e=>t=>{for(let n=0;n<e.length;n++)if(e[n](t))return!0;return!1})(t.map(t=>e.normalizeCondition(t)))}if("object"!=typeof t)throw Error("Unexcepted "+typeof t+" when condition was expected ("+t+")");const n=[];if(Object.keys(t).forEach(o=>{const i=t[o];switch(o){case"or":case"include":case"test":i&&n.push(e.normalizeCondition(i));break;case"and":if(i){const t=i.map(t=>e.normalizeCondition(t));n.push(r(t))}break;case"not":case"exclude":if(i){const t=e.normalizeCondition(i);n.push((e=>t=>!e(t))(t))}break;default:throw new Error("Unexcepted property "+o+" in condition")}}),0===n.length)throw new Error("Excepted condition but got "+t);return 1===n.length?n[0]:r(n)}exec(e){const t=[];return this._run(e,{rules:this.rules},t),t}_run(e,t,n){if(t.resource&&!e.resource)return!1;if(t.realResource&&!e.realResource)return!1;if(t.resourceQuery&&!e.resourceQuery)return!1;if(t.compiler&&!e.compiler)return!1;if(t.issuer&&!e.issuer)return!1;if(t.resource&&!t.resource(e.resource))return!1;if(t.realResource&&!t.realResource(e.realResource))return!1;if(e.issuer&&t.issuer&&!t.issuer(e.issuer))return!1;if(e.resourceQuery&&t.resourceQuery&&!t.resourceQuery(e.resourceQuery))return!1;if(e.compiler&&t.compiler&&!t.compiler(e.compiler))return!1;const r=Object.keys(t).filter(e=>!["resource","realResource","resourceQuery","compiler","issuer","rules","oneOf","use","enforce"].includes(e));for(const e of r)n.push({type:e,value:t[e]});if(t.use){const r=o=>{"function"==typeof o?r(o(e)):Array.isArray(o)?o.forEach(r):n.push({type:"use",value:o,enforce:t.enforce})};r(t.use)}if(t.rules)for(let r=0;r<t.rules.length;r++)this._run(e,t.rules[r],n);if(t.oneOf)for(let r=0;r<t.oneOf.length&&!this._run(e,t.oneOf[r],n);r++);return!0}findOptionsByIdent(e){const t=this.references[e];if(!t)throw new Error("Can't find options with ident '"+e+"'");return t}}},function(e,t,n){(function(t){const r=n(9),o=n(26),i=n(27),s=e=>/(\/|\\|@)eslint-loader/.test(e.path),a=e=>/(\/|\\|@)null-loader/.test(e.path),c=e=>/(\/|\\|@)css-loader/.test(e.path),u=e=>e.path!==t;e.exports=e=>e,e.exports.pitch=function(e){const t=o.getOptions(this),{cacheDirectory:l,cacheIdentifier:d}=t,f=r.parse(this.resourceQuery.slice(1));let p=this.loaders;if(f.type&&(p=/\.vue$/.test(this.resourcePath)?p.filter(e=>!s(e)):(e=>{const t=[];let n=!1;return e.forEach(e=>{s(e)?n||(n=!0,t.push(e)):t.push(e)}),t})(p)),p=p.filter(u),p.some(a))return;const m=e=>{const t=new Map,n=[];return e.forEach(e=>{const r="string"==typeof e?e:e.path,o="string"==typeof e?e:e.request;t.has(r)||(t.set(r,!0),n.push(o))}),o.stringifyRequest(this,"-!"+[...n,this.resourcePath+this.resourceQuery].join("!"))};if("style"===f.type){const e=p.findIndex(c);if(e>-1){const t=m([...p.slice(0,e+1),134,...p.slice(e+1)]);return`import mod from ${t}; export default mod; export * from ${t}`}}if("template"===f.type){const e=n(4);return"export * from "+m([...l&&d?["cache-loader?"+JSON.stringify({cacheDirectory:e.isAbsolute(l)?e.relative(process.cwd(),l):l,cacheIdentifier:i(d)+"-vue-loader-template"})]:[],"133??vue-loader-options",...p])}if("custom"===f.type&&1===p.length&&108===p[0].path)return"";const v=m(p);return`import mod from ${v}; export default mod; export * from ${v}`}}).call(this,"node_modules\\vue-loader\\lib\\loaders\\pitcher.js")},function(e,t,n){const r=n(4),o=n(27),i=n(9),s=n(25),a=n(109),c=n(26),{attrsToQuery:u}=n(28),{parse:l}=n(29),d=n(129),{genHotReloadCode:f}=n(130),p=n(131),{NS:m}=n(25);let v=!1;function h(){try{return n(42)}catch(e){throw new Error("[vue-loader] vue-template-compiler must be installed as a peer dependency, or a compatible compiler implementation must be passed via options.")}}e.exports=function(e){const t=this;v||t["thread-loader"]||t[m]||(t.emitError(new Error("vue-loader was used without the corresponding plugin. Make sure to include VueLoaderPlugin in your webpack config.")),v=!0);const n=e=>c.stringifyRequest(t,e),{target:s,request:g,minimize:y,sourceMap:E,rootContext:b,resourcePath:k,resourceQuery:w}=t,S=w.slice(1),O="&"+S,N=i.parse(S),I=c.getOptions(t)||{},T="node"===s,x=!!I.shadowMode,_=I.productionMode||y||!0,R=r.basename(k),D=b||process.cwd(),P=r.dirname(r.relative(D,k)),A=l({source:e,compiler:I.compiler||h(),filename:R,sourceRoot:P,needMap:E});if(N.type)return a(A,t,N,!!I.appendExtension);const L=r.relative(D,k).replace(/^(\.\.[\/\\])+/,""),q=L.replace(/\\/g,"/")+w,C=o(_?q+"\n"+e:q),M=A.styles.some(e=>e.scoped),j=A.template&&A.template.attrs.functional,U=!T&&!_&&(A.script||A.template)&&!1!==I.hotReload;let F,$="var render, staticRenderFns";if(A.template){$="import { render, staticRenderFns } from "+(F=n((A.template.src||k)+`?vue&type=template${"&id="+C}${M?"&scoped=true":""}${u(A.template.attrs)}${O}`))}let B="var script = {}";if(A.script){const e=n((A.script.src||k)+`?vue&type=script${u(A.script.attrs,"js")}${O}`);B=`import script from ${e}\nexport * from `+e}let V="";A.styles.length&&(V=d(t,A.styles,C,k,n,U,T||x));let z=`\n${$}\n${B}\n${V}\n\n/* normalize component */\nimport normalizer from ${n("!132")}\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  ${j?"true":"false"},\n  ${/injectStyles/.test(V)?"injectStyles":"null"},\n  ${M?JSON.stringify(C):"null"},\n  ${T?JSON.stringify(o(g)):"null"}\n  ${x?",true":""}\n)\n  `.trim()+"\n";return A.customBlocks&&A.customBlocks.length&&(z+=p(A.customBlocks,k,w,n)),U&&(z+="\n"+f(C,j,F)),z+="\ncomponent.options.__file = "+(_?JSON.stringify(R):JSON.stringify(L.replace(/\\/g,"/"))),z+="\nexport default component.exports",z},e.exports.VueLoaderPlugin=s},function(e,t){e.exports=function(e,t,n,r){if("template"===n.type)return r&&(t.resourcePath+="."+(e.template.lang||"html")),void t.callback(null,e.template.content,e.template.map);if("script"===n.type)return r&&(t.resourcePath+="."+(e.script.lang||"js")),void t.callback(null,e.script.content,e.script.map);if("style"===n.type&&null!=n.index){const o=e.styles[n.index];return r&&(t.resourcePath+="."+(o.lang||"css")),void t.callback(null,o.content,o.map)}if("custom"!==n.type||null==n.index);else{const r=e.customBlocks[n.index];t.callback(null,r.content,r.map)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(111),o=n(27),i=n(112)(100),s=/\r?\n/g,a=/^(?:\/\/)?\s*$/;function c(e,t,n,o,i){const c=new r.SourceMapGenerator({file:e.replace(/\\/g,"/"),sourceRoot:o.replace(/\\/g,"/")});let u=0;return i||(u=t.split(n).shift().split(s).length-1),c.setSourceContent(e,t),n.split(s).forEach((t,n)=>{a.test(t)||c.addMapping({source:e,original:{line:n+1+u,column:0},generated:{line:n+1,column:0}})}),JSON.parse(c.toString())}t.parse=function(e){const{source:t,filename:n="",compiler:r,compilerParseOptions:s={pad:"line"},sourceRoot:a="",needMap:u=!0}=e,l=o(n+t);let d=i.get(l);return d||(d=r.parseComponent(t,s),u&&(d.script&&!d.script.src&&(d.script.map=c(n,t,d.script.content,a,s.pad)),d.styles&&d.styles.forEach(e=>{e.src||(e.map=c(n,t,e.content,a,s.pad))})),i.set(l,d),d)}},function(e,t){e.exports=require("source-map")},function(e,t){e.exports=require("lru-cache")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(114)),i=r(n(116)),s=n(117),a=n(118);function c(e,t){const{source:n,filename:r,preprocessOptions:o}=e,i=Object.assign({filename:r},o);let s,a;if(t.render(n,i,(e,t)=>{e&&(a=e),s=t}),a)throw a;return s}function u(e){const{source:t,compiler:r,compilerOptions:s={},transpileOptions:c={},transformAssetUrls:u,isProduction:l=!0,isFunctional:d=!1,optimizeSSR:f=!1,prettify:p=!0}=e,m=f&&r.ssrCompile?r.ssrCompile:r.compile;let v=s;if(u){const e=[!0===u?o.default():o.default(u),i.default()];v=Object.assign({},s,{modules:[...e,...s.modules||[]]})}const{render:h,staticRenderFns:g,tips:y,errors:E}=m(t,v);if(E&&E.length)return{code:"var render = function () {}\nvar staticRenderFns = []\n",source:t,tips:y,errors:E};{const e=Object.assign({},c,{transforms:Object.assign({},c.transforms,{stripWithFunctional:d})}),r=e=>`function (${d?"_h,_vm":""}) {${e}}`;let o=a(`var __render__ = ${r(h)}\nvar __staticRenderFns__ = [${g.map(r)}]`,e)+"\n";return o=o.replace(/\s__(render|staticRenderFns)__\s/g," $1 "),l||(o+="render._withStripped = true",p&&(o=n(119).format(o,{semi:!1,parser:"babel"}))),{code:o,source:t,tips:y,errors:E}}}t.compileTemplate=function(e){const{preprocessLang:t}=e,n=t&&s[t];return n?u(Object.assign({},e,{source:c(e,n)})):t?{code:"var render = function () {}\nvar staticRenderFns = []\n",source:e.source,tips:[`Component ${e.filename} uses lang ${t} for template. Please install the language preprocessor.`],errors:[`Component ${e.filename} uses lang ${t} for template, however it is not installed.`]}:u(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(40),o={video:["src","poster"],source:"src",img:"src",image:["xlink:href","href"],use:["xlink:href","href"]};function i(e,t){if(e.name===t){const t=e.value;if('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))return e.value=r.urlToRequire(t.slice(1,-1)),!0}return!1}t.default=e=>{const t=e?Object.assign({},o,e):o;return{postTransformNode:e=>{!function(e,t){for(const n in t)if(("*"===n||e.tag===n)&&e.attrs){const r=t[n];"string"==typeof r?e.attrs.some(e=>i(e,r)):Array.isArray(r)&&r.forEach(t=>e.attrs.some(e=>i(e,t)))}}(e,t)}}}},function(e,t){e.exports=require("url")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(40);t.default=()=>({postTransformNode:e=>{!function(e){-1!==["img","source"].indexOf(e.tag)&&e.attrs&&e.attrs.forEach(e=>{if("srcset"===e.name){const t=e.value;if(!('"'===t.charAt(0)&&'"'===t.charAt(t.length-1)))return;const n=t.substr(1,t.length-2).split(",").map(e=>{const[t,n]=e.replace(o," ").trim().split(" ",2);return{require:r.urlToRequire(t),descriptor:n}}).map(({require:e,descriptor:t})=>`${e} + "${t?" "+t:""}, " + `).join("").slice(0,-6).concat('"').replace(/ \+ ""$/,"");e.value=n}})}(e)}});const o=/( |\\t|\\n|\\f|\\r)+/g},function(e,t){e.exports=require("consolidate")},function(e,t){e.exports=require("vue-template-es2015-compiler")},function(e,t){e.exports=require("prettier")},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(30),i=r(n(121)),s=r(n(122)),a=n(124);function c(e){const{filename:t,id:n,scoped:r=!0,trim:c=!0,preprocessLang:u,postcssOptions:l,postcssPlugins:d}=e,f=u&&a.processors[u],p=f&&function(e,t){return t.render(e.source,e.map,Object.assign({filename:e.filename},e.preprocessOptions))}(e,f),m=p?p.map:e.map,v=p?p.code:e.source,h=(d||[]).slice();c&&h.push(i.default()),r&&h.push(s.default(n));const g=Object.assign({},l,{to:t,from:t});let y,E,b;m&&(g.map={inline:!1,annotation:!1,prev:m});const k=[];p&&p.errors.length&&k.push(...p.errors);try{if(y=o(h).process(v,g),e.isAsync)return y.then(e=>({code:e.css||"",map:e.map&&e.map.toJSON(),errors:k,rawResult:e})).catch(e=>({code:"",map:void 0,errors:[...k,e.message],rawResult:void 0}));E=y.css,b=y.map}catch(e){k.push(e)}return{code:E||"",map:b&&b.toJSON(),errors:k,rawResult:y}}t.compileStyle=function(e){return c(Object.assign({},e,{isAsync:!1}))},t.compileStyleAsync=function(e){return Promise.resolve(c(Object.assign({},e,{isAsync:!0})))},t.doCompileStyle=c},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(30));t.default=o.plugin("trim",()=>e=>{e.walk(({type:e,raws:t})=>{"rule"!==e&&"atrule"!==e||(t.before&&(t.before="\n"),t.after&&(t.after="\n"))})})},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(30)),i=n(123);t.default=o.plugin("add-id",e=>t=>{const n=e,r=Object.create(null);t.each((function e(t){t.selector?t.selector=i(e=>{e.each(e=>{let t=null;e.each(e=>"combinator"!==e.type||">>>"!==e.value&&"/deep/"!==e.value?"pseudo"===e.type&&"::v-deep"===e.value?(e.value=e.spaces.before=e.spaces.after="",!1):void("pseudo"!==e.type&&"combinator"!==e.type&&(t=e)):(e.value=" ",e.spaces.before=e.spaces.after="",!1)),t?t.spaces.after="":e.first.spaces.before="",e.insertAfter(t,i.attribute({attribute:n}))})}).processSync(t.selector):"atrule"===t.type&&("media"===t.name||"supports"===t.name?t.each(e):/-?keyframes$/.test(t.name)&&(r[t.params]=t.params=t.params+"-"+n))})),Object.keys(r).length&&t.walkDecls(e=>{/^(-\w+-)?animation-name$/.test(e.prop)&&(e.value=e.value.split(",").map(e=>r[e.trim()]||e.trim()).join(",")),/^(-\w+-)?animation$/.test(e.prop)&&(e.value=e.value.split(",").map(e=>{const t=e.trim().split(/\s+/),n=t.findIndex(e=>r[e]);return-1!==n?(t.splice(n,1,r[t[n]]),t.join(" ")):e}).join(","))})})},function(e,t){e.exports=require("postcss-selector-parser")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(125),o={render(e,t,o){const i=n(126),s=Object.assign({},o,{data:e,file:o.filename,outFile:o.filename,sourceMap:!!t});try{const e=i.renderSync(s);return t?{code:e.css.toString(),map:r(t,JSON.parse(e.map.toString())),errors:[]}:{code:e.css.toString(),errors:[]}}catch(e){return{code:"",errors:[e]}}}},i={render:(e,t,n)=>o.render(e,t,Object.assign({},n,{indentedSyntax:!0}))},s={render(e,t,o){const i=n(127);let s,a=null;return i.render(e,Object.assign({},o,{syncImport:!0}),(e,t)=>{a=e,s=t}),a?{code:"",errors:[a]}:t?{code:s.css.toString(),map:r(t,s.map),errors:[]}:{code:s.css.toString(),errors:[]}}},a={render(e,t,o){const i=n(128);try{const n=i(e);Object.keys(o).forEach(e=>n.set(e,o[e])),t&&n.set("sourcemap",{inline:!1,comment:!1});const s=n.render();return t?{code:s,map:r(t,n.sourcemap),errors:[]}:{code:s,errors:[]}}catch(e){return{code:"",errors:[e]}}}};t.processors={less:s,sass:i,scss:o,styl:a,stylus:a}},function(e,t){e.exports=require("merge-source-map")},function(e,t){e.exports=require("node-sass")},function(e,t){e.exports=require("less")},function(e,t){e.exports=require("stylus")},function(e,t,n){const{attrsToQuery:r}=n(28),o=JSON.stringify(41);e.exports=function(e,t,n,i,s,a,c){let u="",l="",d="",f=!1;const p=new Map;function m(t,o){const a=t.src||i,c=r(t.attrs,"css"),u="&"+e.resourceQuery.slice(1),l=t.scoped?"&id="+n:"";return s(a+`?vue&type=style&index=${o}${l}${c}${u}`)}function v(t,r,i){f=!0;const s=!0===t.module?"$style":t.module;p.has(s)&&e.emitError(`CSS module name ${s} is not unique!`),p.set(s,!0);const c=`(style${i}.locals || style${i})`,u=JSON.stringify(s);a?(l+=`\n        cssModules[${u}] = ${c}\n        Object.defineProperty(this, ${u}, {\n          get: function () {\n            return cssModules[${u}]\n          }\n        })\n      `,d+=`\n        module.hot && module.hot.accept([${r}], function () {\n          var oldLocals = cssModules[${u}]\n          if (oldLocals) {\n            var newLocals = require(${r})\n            if (JSON.stringify(newLocals) !== JSON.stringify(oldLocals)) {\n              cssModules[${u}] = newLocals\n              require(${o}).rerender("${n}")\n            }\n          }\n        })\n      `):l+=`this[${u}] = ${c}\n`}return c?t.forEach((e,t)=>{const n=m(e,t);l+=`var style${t} = require(${n})\nif (style${t}.__inject__) style${t}.__inject__(context)\n`,e.module&&v(e,n,t)}):t.forEach((e,t)=>{const n=m(e,t);u+=`import style${t} from ${n}\n`,e.module&&v(e,n,t)}),c||f?`\n${u}\n${f&&a?"var cssModules = {}":""}\n${a?"var disposed = false":""}\n\nfunction injectStyles (context) {\n  ${a?"if (disposed) return":""}\n  ${l}\n}\n\n${a?"\n  module.hot && module.hot.dispose(function (data) {\n    disposed = true\n  })\n":""}\n\n${d}\n  `.trim():u}},function(e,t,n){const r=JSON.stringify(41);t.genHotReloadCode=(e,t,n)=>`\n/* hot reload */\nif (module.hot) {\n  var api = require(${r})\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('${e}', component.options)\n    } else {\n      api.${t?"rerender":"reload"}('${e}', component.options)\n    }\n    ${n?((e,t)=>`\n    module.hot.accept(${t}, function () {\n      api.rerender('${e}', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  `.trim())(e,n):""}\n  }\n}\n  `.trim()},function(e,t,n){const r=n(9),{attrsToQuery:o}=n(28);e.exports=function(e,t,n,i){return"\n/* custom blocks */\n"+e.map((e,s)=>{const a=e.attrs.src||t,c=o(e.attrs),u=e.attrs.src?"&issuerPath="+r.escape(t):"",l=n?"&"+n.slice(1):"",d=`?vue&type=custom&index=${s}&blockType=${r.escape(e.type)}${u}${c}${l}`;return`import block${s} from ${i(a+d)}\nif (typeof block${s} === 'function') block${s}(component)`}).join("\n")+"\n"}},function(e,t,n){"use strict";function r(e,t,n,r,o,i,s,a){var c,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),r&&(u.functional=!0),i&&(u._scopeId="data-v-"+i),s?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},u._ssrRegister=c):o&&(c=a?function(){o.call(this,this.$root.$options.shadowRoot)}:o),c)if(u.functional){u._injectStyles=c;var l=u.render;u.render=function(e,t){return c.call(t),l(e,t)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:u}}n.r(t),n.d(t,"default",(function(){return r}))},function(e,t,n){const r=n(9),o=n(26),{compileTemplate:i}=n(29);e.exports=function(e){const t=this,s=r.parse(this.resourceQuery.slice(1)),a=o.getOptions(t)||{},{id:c}=s,u="node"===t.target,l=t.minimize||!0,d=s.functional,f=a.compiler||n(42),p=Object.assign({},a.compilerOptions,{scopeId:s.scoped?"data-v-"+c:null,comments:s.comments}),m={source:e,filename:this.resourcePath,compiler:f,compilerOptions:p,transpileOptions:a.transpileOptions,transformAssetUrls:a.transformAssetUrls||!0,isProduction:l,isFunctional:d,optimizeSSR:u&&!1!==a.optimizeSSR},v=i(m);v.tips&&v.tips.length&&v.tips.forEach(e=>{t.emitWarning(e)}),v.errors&&v.errors.length&&t.emitError(`\n  Error compiling template:\n${function(e){return e.split(/\r?\n/).map(e=>"  "+e).join("\n")}(v.source)}\n`+v.errors.map(e=>"  - "+e).join("\n")+"\n");const{code:h}=v;return h+"\nexport { render, staticRenderFns }"}},function(e,t,n){const r=n(9),{compileStyle:o}=n(29);e.exports=function(e,t){const n=r.parse(this.resourceQuery.slice(1)),{code:i,map:s,errors:a}=o({source:e,filename:this.resourcePath,id:"data-v-"+n.id,map:t,scoped:!!n.scoped,trim:!0});a.length?this.callback(a[0]):this.callback(null,i,s)}},function(e,t){e.exports=require("webpack-dev-middleware")},function(e,t){e.exports=require("webpack-hot-middleware")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(1),i=(n(0),n(14)),s=n(13),a=n(5),c=n(15),u=n(2),l=(n(43),void 0),d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=s(),this.createdAt=Date.now(),this.service=t,this.io=t.io,this.app=null,this.req=null,this.res=null,this.action=null,this.t=null,this.user=null,this.socket=null,this.params=[],this.model=null,this.modelID=null,this.provider="internal",this.validationErrors=[],l||(l=n(8))}return r(e,[{key:"services",value:function(e){return l.get(e)}},{key:"copy",value:function(t,n){var r=u.defaults(new e(this.service),this);return r.provider="internal",r.params=!0===n?u.defaults(this.params,t):t,r}},{key:"responseTime",value:function(){return Date.now()-this.createdAt}},{key:"resolveModel",value:function(){var e=this;if(u.isFunction(this.service.modelResolver)){var t=this.service.$settings.idParamName||"id",n=this.params[t];if(null!=n)return this.service.modelResolver.call(this.service,this,n).then((function(t){return e.model=t,t}))}return Promise.resolve(null)}},{key:"assertModelIsExist",value:function(e){if(!this.model)throw this.errorBadRequest(a.ERR_MODEL_NOT_FOUND,e);return!0}},{key:"checkPermission",value:function(){var e=this,t=this.action.permission||this.service.$settings.permission||a.PERM_LOGGEDIN;return t==a.PERM_PUBLIC?Promise.resolve():Promise.resolve().then((function(){e.user||e.errorUnauthorized()})).then((function(){t!=a.PERM_ADMIN||e.isAdmin()?t==a.PERM_USER&&-1==e.user.roles.indexOf(a.ROLE_USER)&&e.errorForbidden():e.errorForbidden()})).then((function(){if(t==a.PERM_OWNER&&u.isFunction(e.service.$schema.ownerChecker))return e.service.$schema.ownerChecker(e).catch((function(t){if(u.isObject(t))throw t;e.errorForbidden(a.ERR_ONLY_OWNER_CAN_EDIT_AND_DELETE,e.t("app:YouAreNotTheOwner"))}))}))}},{key:"broadcast",value:function(e,t){if(this.io){var n="/"+this.service.namespace+"/"+e;o.debug("Send WS broadcast message to '"+n+"':",t),this.io.emit(n,t)}}},{key:"emitUser",value:function(e,t){var n=this;if(!this.socket&&this.user&&(this.socket=u.find(c.userSockets,(function(e){return e.request.user._id==n.user._id}))),this.socket){var r="/"+this.service.namespace+"/"+e;o.debug("Send WS message to "+this.socket.request.user.username+" '"+r+"':",t),this.socket.emit(r,t)}}},{key:"emit",value:function(e,t,n){var r=this;if(n||(n=this.service.$settings.role),!n){var i="/"+this.service.namespace+"/"+e;return o.debug("Send WS broadcast message to '"+i+"':",t),void(this.socket?this.socket.broadcast.emit(i,t):this.io.emit(i,t))}if(this.io){var s="/"+this.service.namespace+"/"+e;o.debug("Send WS message to '"+n+"' role '"+s),u.each(c.userSockets,(function(e){var i=e.request.user;if(i&&i.roles&&-1!==i.roles.indexOf(n)){if("socket"==r.provider&&i==r.user)return;o.debug("Send WS message to "+i.username+" '"+s+"':",t),e.emit(s,t)}}))}}},{key:"hasParam",value:function(e,t){return null!=this.params[e]}},{key:"validateParam",value:function(e,t){var n=this,r={name:e,value:null,errors:[],noError:function(){return 0==r.errors.length},addError:function(e){r.errors.push(e),n.validationErrors.push(e)},end:function(){return r.noError()&&(n.params[r.name]=r.value),r.value},throw:function(){if(!r.noError())throw new Error(r.errors.join(" "));return r.value},notEmpty:function(t){return null!=r.value&&""!==r.value||r.addError(t||"Parameter '"+e+"' is empty!"),u.isArray(r.value)&&0==r.value.length&&r.addError(t||"Parameter '"+e+"' is empty!"),r},isNumber:function(e){return null==r.value||u.isNumber(r.value)},trim:function(){return r.noError()&&null!=r.value&&(r.value=r.value.trim()),r}},o=this.params[e];return null!=o&&(r.value=o),r}},{key:"hasValidationErrors",value:function(){return this.validationErrors.length>0}},{key:"errorBadRequest",value:function(e,t){var n=new Error(t);throw n=u.defaults(i.BAD_REQUEST),e&&(n.type=e),t&&(n.message=t),n}},{key:"errorForbidden",value:function(e,t){var n=new Error(t);throw n=u.defaults(i.FORBIDDEN),e&&(n.type=e),t&&(n.message=t),n}},{key:"errorUnauthorized",value:function(e,t){var n=new Error(t);throw n=u.defaults(i.UNAUTHORIZED),e&&(n.type=e),t&&(n.message=t),n}},{key:"notifyChanges",value:function(e,t,n){var r={status:200,event:e,data:t};if(this.user){var o=this.services("persons");r.user=o.toJSON(this.user)}this.emit(e,r,n)}},{key:"queryPageSort",value:function(e){if(this.params){if(this.params.limit){var t=parseInt(this.params.limit);e.limit(t)}if(this.params.offset){var n=parseInt(this.params.offset);e.skip(n)}this.params.sort&&e.sort(this.params.sort.replace(/,/," "))}return e}},{key:"isAuthenticated",value:function(e){return null!=this.user}},{key:"hasRole",value:function(e){return this.user&&-1!=this.user.roles.indexOf(e)}},{key:"isAdmin",value:function(){return this.user&&this.hasRole(a.ROLE_ADMIN)}}],[{key:"CreateFromREST",value:function(t,n,r,o,i){var s=new e(t);return s.provider="rest",s.app=r,s.req=o,s.res=i,s.t=o.t,s.user=o.user,s.params=u.defaults({},o.query,o.params,o.body),s.action=n,s}},{key:"CreateFromSocket",value:function(t,n,r,o,i){var s=new e(t);return s.provider="socket",s.app=r,s.socket=o,s.t=r.t,s.user=o.request.user,s.params=i||{},s.action=n,s}},{key:"CreateFromGraphQL",value:function(t,n,r,o,i){var s=new e(t);return s.provider="graphql",s.t=i.t,s.params=o,s.user=i.user,s.action=n,i.ctx=s,s}},{key:"CreateToServiceInit",value:function(t){var n=new e(t);return n.provider="",n.app=t.$app,n}}]),e}();e.exports=d},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("express-list-endpoints")},function(e,t){e.exports=require("cli-table2")},function(e,t){e.exports=require("graphql")},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o=n(1),i=n(0),s=(n(15),n(5)),a=n(2),c=n(43),u=n(145),l=void 0,d=function(e){o.warn("[Service warn]: "+e)},f=function(e){throw new Error("[Service warn]: "+e)},p=function(){function e(t,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var c=this;t=t||{},c.$schema=t,c.$app=r,c.$db=o,l||(l=n(8)),t.settings||f("No settings of service '"+c.name+"'! Please create a settings object in service schema!");var p=a.defaultsDeep(t.settings,{version:1,namespace:"",internal:!1,rest:!1,ws:!1,graphql:!1,permission:s.PERM_LOGGEDIN,role:s.ROLE_USER,idParamName:"code",modelPropFilter:null});if(c.$settings=p,c.name=p.name,c.version=p.version,c.namespace=p.namespace,c.collection=p.collection,c.name||f("No name of service '"+c.name+"'! Please set in settings of service schema!"),!c.namespace&&(p.rest||p.ws||p.graphql)&&f("No namespace of service '"+c.name+"'! Please set in settings of service schema!"),i.cacheTimeout){var m=i.redis.enabled?"redis":"memory";c.$cacher=new u(m,c.name,i.cacheTimeout)}t.actions&&a.isObject(t.actions)&&(c.actions={},a.forIn(t.actions,(function(e,t){if(a.isFunction(e)&&(e={handler:e,name:t}),a.isFunction(e.handler)){var n=e.handler.bind(c);e.cache&&(n=function(e,t){return function(n){var r=c.getCacheKey(e.name,n.params);return c.getFromCache(r).then((function(e){return null!=e?e:t(n).then((function(e){return c.putToCache(r,e),e}))}))}}(e,n)),c.actions[t]=n}c.actions[t].settings=e,c.actions[t].settings.name=c.actions[t].settings.name||t,delete c.actions[t].settings.handler}))),t.methods&&a.isObject(t.methods)&&a.forIn(t.methods,(function(e,t){-1==["name","version","namespace","collection","actions"].indexOf(t)?-1==["toJSON","getByID","modelResolver"].indexOf(t)?c[t]=e.bind(c):d("This method name '"+t+"' is prohibited under 'methods' object. If you want to override the built-in method, please declare in the root of service schema! Skipping..."):d("Invalid method name '"+t+"' in '"+c.name+"' service! Skipping...")}));["toJSON","getByID","modelResolver"].forEach((function(e){a.isFunction(t[e])&&(c["__"+e]=c[e],c[e]=t[e].bind(c))}))}return r(e,[{key:"toJSON",value:function(e,t){var n=function(e){var n=e.toJSON();return null!=t?a.pick(n,t):n};return null==t&&(t=this.$settings.modelPropFilter),a.isString(t)&&(t=t.split(" ")),a.isArray(e)?a.map(e,(function(e){return n(e)})):a.isObject(e)?n(e):void 0}},{key:"populateModels",value:function(e,t){if(t=t||this.$settings.modelPopulates,null!=e&&t){var n=[];if(a.forIn(t,(function(t,r){if(a.isString(t)){var o=l.get(t);if(o&&a.isFunction(o.getByID))(a.isArray(e)?e:[e]).forEach((function(e){n.push(o.getByID(e[r]).then((function(t){e[r]=t})))}))}})),n.length>0)return Promise.all(n).then((function(){return e}))}return Promise.resolve(e)}},{key:"getByID",value:function(e){var t=this;if(null==this.collection||null==e)return Promise.resolve();if(a.isArray(e)&&0==e.length)return Promise.resolve([]);var n=i.cacheTimeout?this.getCacheKey("model",e):null;return Promise.resolve().then((function(){return n?t.getFromCache(n):null})).then((function(r){if(r)return r;return(a.isArray(e)?t.collection.find({_id:{$in:e}}):t.collection.findById(e)).exec().then((function(e){return t.toJSON(e)})).then((function(e){return t.populateModels(e)})).then((function(e){return n&&t.putToCache(n,e),e}))}))}},{key:"modelResolver",value:function(e,t){if(null==this.collection)return Promise.resolve();var n=void 0;return n=a.isFunction(this.collection.schema.methods.decodeID)?this.collection.schema.methods.decodeID(t):t,e.modelID=n,null==n||""==n?e.errorBadRequest(s.ERR_INVALID_CODE,e.t("app:InvalidCode")):this.getByID(n)}},{key:"decodeID",value:function(e){if(a.isFunction(this.collection.schema.methods.decodeID))return this.collection.schema.methods.decodeID(e);throw new Error("'decodeID' method not implemented in '"+this.name+"' service!")}},{key:"encodeID",value:function(e){if(a.isFunction(this.collection.schema.methods.encodeID))return this.collection.schema.methods.encodeID(e);throw new Error("'encodeID' method not implemented in '"+this.name+"' service!")}},{key:"getCacheKey",value:function(e,t){return(e?e+":":"")+(t?c(t):"")}},{key:"getFromCache",value:function(e){return this.$cacher?this.$cacher.get(e):Promise.resolve(null)}},{key:"putToCache",value:function(e,t){return this.$cacher?this.$cacher.set(e,t):Promise.resolve()}},{key:"clearCache",value:function(){return this.$cacher?this.$cacher.clean():Promise.resolve()}},{key:"notifyModelChanges",value:function(e,t,n){e.notifyChanges(t,n,this.$settings.role),l.emit(this.name+":"+t,{ctx:e,payload:n}),this.clearCache()}},{key:"services",value:function(e){return l.get(e)}}]),e}();e.exports=p},function(e,t,n){"use strict";n(0),n(1),n(19),n(2);var r=n(146),o=n(147);e.exports=function(e,t,n){switch(e){case"redis":return new o(t,n);default:return new r(t,n)}}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(0);var o=n(1),i=(n(19),n(2),function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cache={},this.prefix=t?t+":":"",this.ttl=n,n&&(this.timer=setInterval((function(){r.checkTTL()}),3e4))}return r(e,[{key:"get",value:function(e){var t=this;return new Promise((function(n,r){var i=t.cache[t.prefix+e];i?(o.debug("[Cacher] GET "+t.prefix+e),n(i.data),i.expire=Date.now()+1e3*t.ttl):n(null)}))}},{key:"set",value:function(e,t){return this.cache[this.prefix+e]={data:t,expire:Date.now()+1e3*this.ttl},o.debug("[Cacher] SET "+this.prefix+e),Promise.resolve(t)}},{key:"del",value:function(e){return delete this.cache[this.prefix+e],o.debug("[Cacher] DEL "+this.prefix+e),Promise.resolve()}},{key:"clean",value:function(e){return o.debug("[Cacher] CLEAR "+this.prefix+"*"),this.cache={},Promise.resolve()}},{key:"checkTTL",value:function(){var e=this,t=this,n=Date.now();Object.keys(this.cache).forEach((function(r){var i=e.cache[r];i.expire&&i.expire<n&&(o.debug("[Cacher] EXPIRED "+r),delete t.cache[r])}))}}]),e}());e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(0);var o=n(1),i=n(19),s=n(2),a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o.debug("Redis Cacher created. Prefix: "+t),this.prefix=t?t+":":"",this.ttl=n}return r(e,[{key:"get",value:function(e){return i.get(this.prefix+e).then((function(e){if(e)try{return JSON.parse(e)}catch(e){o.error("Redis result parse error!",e)}return e}))}},{key:"set",value:function(e,t){return s.isObject(t)&&(t=JSON.stringify(t)),this.ttl?i.setex(this.prefix+e,this.ttl,t):i.set(this.prefix+e,t)}},{key:"del",value:function(e){return i.del(this.prefix+e,(function(e){e&&o.error("Redis `del` error!",e)})),Promise.resolve()}},{key:"clean",value:function(e){var t=this;return function n(r,o){i.scan(r,"MATCH",t.prefix+(e||"*"),"COUNT",100,(function(e,t){if(e)return o(e);var r=parseInt(t[0]),s=t[1];if(!r&&!s.length)return o(null);i.del(s,(function(e){return e?o(e):r?void n(r,o):o(null)}))}))}(0,(function(e){e&&o.error("Redis `scanDel` error!",e)})),Promise.resolve()}}]),e}();e.exports=a},function(e,t,n){var r={"./mailer.js":149};function o(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=148},function(e,t,n){"use strict";var r=n(1),o=n(0),i=(n(5),n(44)),s=n(45).htmlToText;e.exports={settings:{name:"mailer",internal:!0},methods:{send:function(e,t,a){return new Promise((function(c,u){r.info("Sending email to "+e+" with subject "+t+"...");var l={};e instanceof Object?e instanceof Array?l.to=e:l=e:l.to=e;var d={from:o.mailer.from,to:l.to,cc:l.cc,bcc:l.bcc,subject:t,html:a},f=void 0;if("smtp"==o.mailer.transport)f=i.createTransport(o.mailer.smtp);else if("mailgun"==o.mailer.transport){var p=n(46);f=i.createTransport(p({auth:{api_key:o.mailer.mailgun.apiKey,domain:o.mailer.mailgun.domain}}))}else if("sendgrid"==o.mailer.transport){var m=n(47);f=i.createTransport(m({auth:{api_key:o.mailer.sendgrid.apiKey}}))}f?(f.use("compile",s()),f.sendMail(d,(function(e,t){e?(r.warn("Unable to send email: ",e),u(e)):(r.info("Email message sent.",t.response),c(t))}))):u(new Error("Unable to send email! Invalid mailer transport: "+o.mailer.transport))}))}},init:function(e){}}},function(e,t,n){var r={"./counter/service.js":151,"./devices/service.js":153,"./persons/service.js":154,"./posts/service.js":156,"./profile/service.js":157,"./session/service.js":159};function o(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=150},function(e,t,n){"use strict";var r=n(1),o=(n(0),n(5)),i=n(152);e.exports={settings:{name:"counter",version:1,namespace:"counter",rest:!0,ws:!0,permission:o.PERM_LOGGEDIN},actions:{find:{cache:!0,handler:function(e){return Promise.resolve(i.counter)}},create:function(e){if(e.params.value)return this.changeCounter(e,parseInt(e.params.value));throw new Error("Missing value from request!")},reset:{permission:o.PERM_ADMIN,handler:function(e){return this.changeCounter(e,0)}},increment:function(e){return this.changeCounter(e,i.counter+1)},decrement:function(e){return this.changeCounter(e,i.counter-1)}},methods:{changeCounter:function(e,t){return i.counter=t,r.info(e.user.username+" changed the counter to ",i.counter),this.notifyModelChanges(e,"changed",i.counter),Promise.resolve(i.counter)}},init:function(e){},socket:{afterConnection:function(e,t){e.emit("/counter/changed",i.counter)}},graphql:{query:"\n\t\t\tcounter: Int\n\t\t",types:"",mutation:"\n\t\t\tcounterCreate(value: Int!): Int\n\t\t\tcounterReset: Int\n\t\t\tcounterIncrement: Int\n\t\t\tcounterDecrement: Int\n\t\t",resolvers:{Query:{counter:"find"},Mutation:{counterCreate:"create",counterReset:"reset",counterIncrement:"increment",counterDecrement:"decrement"}}}}},function(e,t,n){"use strict";e.exports={counter:0}},function(e,t,n){"use strict";n(1),n(0);var r=n(5),o=(n(2),n(34));e.exports={settings:{name:"devices",version:1,namespace:"devices",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code type address name description status lastCommunication createdAt updatedAt"},actions:{find:{cache:!0,handler:function(e){var t=this,n=o.find({});return e.queryPageSort(n).exec().then((function(e){return t.toJSON(e)}))}},get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:DeviceNotFound")),Promise.resolve(e.model)}},create:function(e){var t=this;return this.validateParams(e,!0),new o({address:e.params.address,type:e.params.type,name:e.params.name,description:e.params.description,status:e.params.status}).save().then((function(e){return t.toJSON(e)})).then((function(e){return t.populateModels(e)})).then((function(n){return t.notifyModelChanges(e,"created",n),n}))},update:function(e){var t=this;return e.assertModelIsExist(e.t("app:DeviceNotFound")),this.validateParams(e),this.collection.findById(e.modelID).exec().then((function(t){return null!=e.params.address&&(t.address=e.params.address),null!=e.params.type&&(t.type=e.params.type),null!=e.params.name&&(t.name=e.params.name),null!=e.params.description&&(t.description=e.params.description),null!=e.params.status&&(t.status=e.params.status),t.save()})).then((function(e){return t.toJSON(e)})).then((function(e){return t.populateModels(e)})).then((function(n){return t.notifyModelChanges(e,"updated",n),n}))},remove:function(e){var t=this;return e.assertModelIsExist(e.t("app:DeviceNotFound")),o.remove({_id:e.modelID}).then((function(){return e.model})).then((function(n){return t.notifyModelChanges(e,"removed",n),n}))}},methods:{validateParams:function(e,t){if((t||e.hasParam("name"))&&e.validateParam("name").trim().notEmpty(e.t("app:DeviceNameCannotBeBlank")).end(),(t||e.hasParam("status"))&&e.validateParam("status").isNumber(),e.validateParam("description").trim().end(),e.validateParam("address").trim().end(),e.validateParam("type").trim().end(),e.hasValidationErrors())throw e.errorBadRequest(r.ERR_VALIDATION_ERROR,e.validationErrors)}},init:function(e){},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\tdevices(limit: Int, offset: Int, sort: String): [Device]\n\t\t\tdevice(code: String): Device\n\t\t",types:"\n\t\t\ttype Device {\n\t\t\t\tcode: String!\n\t\t\t\taddress: String\n\t\t\t\ttype: String\n\t\t\t\tname: String\n\t\t\t\tdescription: String\n\t\t\t\tstatus: Int\n\t\t\t\tlastCommunication: Timestamp\n\t\t\t}\n\t\t",mutation:"\n\t\t\tdeviceCreate(name: String!, address: String, type: String, description: String, status: Int): Device\n\t\t\tdeviceUpdate(code: String!, name: String, address: String, type: String, description: String, status: Int): Device\n\t\t\tdeviceRemove(code: String!): Device\n\t\t",resolvers:{Query:{devices:"find",device:"get"},Mutation:{deviceCreate:"create",deviceUpdate:"update",deviceRemove:"remove"}}}}},function(e,t,n){"use strict";n(1),n(0),n(15);var r=n(5),o=(n(2),n(155));e.exports={settings:{name:"persons",version:1,namespace:"persons",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code username fullName avatar lastLogin roles"},actions:{get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:UserNotFound")),Promise.resolve(e.model)}}},methods:{},graphql:{query:"\n\t\t\t# users(limit: Int, offset: Int, sort: String): [Person]\n\t\t\tperson(code: String): Person\n\t\t",types:"\n\t\t\ttype Person {\n\t\t\t\tcode: String!\n\t\t\t\tfullName: String\n\t\t\t\tusername: String\n\t\t\t\troles: [String]\n\t\t\t\tavatar: String\n\t\t\t\tlastLogin: Timestamp\n\n\t\t\t\tposts(limit: Int, offset: Int, sort: String): [Post]\n\t\t\t}\n\t\t",mutation:"\n\t\t",resolvers:{Query:{person:"get"},Person:{posts:function(e,t,n){var r=n.ctx,o=r.services("posts");if(o)return o.actions.find(r.copy(Object.assign(t,{author:e.code})))}}}}}},function(e,t,n){"use strict";e.exports=n(3)},function(e,t,n){"use strict";n(1),n(0);var r=n(5),o=(n(2),n(35));e.exports={settings:{name:"posts",version:1,namespace:"posts",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code title content author votes voters views createdAt editedAt",modelPopulates:{author:"persons",voters:"persons"}},actions:{find:{cache:!0,handler:function(e){var t=this,n={};"my"==e.params.filter?n.author=e.user.id:null!=e.params.author&&(n.author=this.personService.decodeID(e.params.author));var r=o.find(n);return e.queryPageSort(r).exec().then((function(e){return t.toJSON(e)})).then((function(e){return t.populateModels(e)}))}},get:{cache:!0,permission:r.PERM_PUBLIC,handler:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),o.findByIdAndUpdate(e.modelID,{$inc:{views:1}}).exec().then((function(e){return t.toJSON(e)})).then((function(e){return t.populateModels(e)}))}},create:{handler:function(e){var t=this;return this.validateParams(e,!0),new o({title:e.params.title,content:e.params.content,author:e.user.id}).save().then((function(e){return t.toJSON(e)})).then((function(e){return t.populateModels(e)})).then((function(n){return t.notifyModelChanges(e,"created",n),n}))}},update:{permission:r.PERM_OWNER,handler:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),this.validateParams(e),this.collection.findById(e.modelID).exec().then((function(t){return null!=e.params.title&&(t.title=e.params.title),null!=e.params.content&&(t.content=e.params.content),t.editedAt=Date.now(),t.save()})).then((function(e){return t.toJSON(e)})).then((function(e){return t.populateModels(e)})).then((function(n){return t.notifyModelChanges(e,"updated",n),n}))}},remove:{permission:r.PERM_OWNER,handler:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),o.remove({_id:e.modelID}).then((function(){return e.model})).then((function(n){return t.notifyModelChanges(e,"removed",n),n}))}},vote:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),this.collection.findById(e.modelID).exec().then((function(t){if(-1!==t.voters.indexOf(e.user.id))throw e.errorBadRequest(r.ERR_ALREADY_VOTED,e.t("app:YouHaveAlreadyVotedThisPost"));return t})).then((function(t){return o.findByIdAndUpdate(t.id,{$addToSet:{voters:e.user.id},$inc:{votes:1}},{new:!0})})).then((function(e){return t.toJSON(e)})).then((function(e){return t.populateModels(e)})).then((function(n){return t.notifyModelChanges(e,"voted",n),n}))},unvote:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),this.collection.findById(e.modelID).exec().then((function(t){if(-1==t.voters.indexOf(e.user.id))throw e.errorBadRequest(r.ERR_NOT_VOTED_YET,e.t("app:YouHaveNotVotedThisPostYet"));return t})).then((function(t){return o.findByIdAndUpdate(t.id,{$pull:{voters:e.user.id},$inc:{votes:-1}},{new:!0})})).then((function(e){return t.toJSON(e)})).then((function(e){return t.populateModels(e)})).then((function(n){return t.notifyModelChanges(e,"unvoted",n),n}))}},methods:{validateParams:function(e,t){if((t||e.hasParam("title"))&&e.validateParam("title").trim().notEmpty(e.t("app:PostTitleCannotBeEmpty")).end(),(t||e.hasParam("content"))&&e.validateParam("content").trim().notEmpty(e.t("app:PostContentCannotBeEmpty")).end(),e.hasValidationErrors())throw e.errorBadRequest(r.ERR_VALIDATION_ERROR,e.validationErrors)}},ownerChecker:function(e){return new Promise((function(t,n){e.assertModelIsExist(e.t("app:PostNotFound")),e.model.author.code==e.user.code||e.isAdmin()?t():n()}))},init:function(e){this.personService=e.services("persons"),r.append(["ALREADY_VOTED","NOT_VOTED_YET"],"ERR")},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\tposts(limit: Int, offset: Int, sort: String): [Post]\n\t\t\tpost(code: String): Post\n\t\t",types:"\n\t\t\ttype Post {\n\t\t\t\tcode: String!\n\t\t\t\ttitle: String\n\t\t\t\tcontent: String\n\t\t\t\tauthor: Person!\n\t\t\t\tviews: Int\n\t\t\t\tvotes: Int,\n\t\t\t\tvoters(limit: Int, offset: Int, sort: String): [Person]\n\t\t\t\tcreatedAt: Timestamp\n\t\t\t\tcreatedAt: Timestamp\n\t\t\t}\n\t\t",mutation:"\n\t\t\tpostCreate(title: String!, content: String!): Post\n\t\t\tpostUpdate(code: String!, title: String, content: String): Post\n\t\t\tpostRemove(code: String!): Post\n\n\t\t\tpostVote(code: String!): Post\n\t\t\tpostUnvote(code: String!): Post\n\t\t",resolvers:{Query:{posts:"find",post:"get"},Mutation:{postCreate:"create",postUpdate:"update",postRemove:"remove",postVote:"vote",postUnvote:"unvote"}}}}},function(e,t,n){"use strict";n(1),n(0);var r=n(5),o=(n(2),n(158));e.exports={settings:{name:"profile",version:1,namespace:"profile",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:o,modelPropFilter:"code username fullName email avatar passwordLess provider profile socialLinks roles apiKey lastLogin locale status createdAt updatedAt"},actions:{get:{cache:!1,handler:function(e){var t=this;return o.findById(o.schema.methods.decodeID(e.user.code)).exec().then((function(e){return t.toJSON(e)})).then((function(e){return t.populateModels(e)}))}}},methods:{},graphql:{query:"\n\t\t\tprofile: Profile\n\t\t",types:"\n\t\t\ttype Profile {\n\t\t\t\tcode: String!\n\t\t\t\tfullName: String\n\t\t\t\temail: String\n\t\t\t\tusername: String\n\t\t\t\tpasswordLess: Boolean\n\t\t\t\tprovider: String\n\t\t\t\tprofile: SocialProfile\n\t\t\t\tsocialLinks: SocialLinks\n\t\t\t\troles: [String]\n\t\t\t\tverified: Boolean\n\t\t\t\tapiKey: String\n\t\t\t\tlocale: String\n\t\t\t\tavatar: String\n\t\t\t\tcreatedAt: Timestamp\n\t\t\t\tupdatedAt: Timestamp\n\t\t\t\tlastLogin: Timestamp\n\t\t\t\tstatus: Boolean\n\t\t\t}\n\n\t\t\ttype SocialProfile {\n\t\t\t\tname: String\n\t\t\t\tgender: String\n\t\t\t\tpicture: String\n\t\t\t\tlocation: String\n\t\t\t}\n\n\t\t\ttype SocialLinks {\n\t\t\t\tfacebook: String\n\t\t\t\ttwitter: String\n\t\t\t\tgoogle: String\n\t\t\t\tgithub: String\n\t\t\t}\n\t\t",mutation:"\n\t\t",resolvers:{Query:{profile:"get"}}}}},function(e,t,n){"use strict";e.exports=n(3)},function(e,t,n){"use strict";n(1),n(0);var r=n(5),o=n(2),i=n(15),s=void 0;e.exports={settings:{name:"session",version:1,namespace:"session",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user"},actions:{me:function(e){return Promise.resolve(e.user).then((function(e){return s.toJSON(e)}))},onlineUsers:function(e){return Promise.resolve().then((function(){return s.toJSON(o.map(i.userSockets,(function(e){return e.request.user})))}))}},init:function(e){s=this.services("persons")},graphql:{query:"\n\t\t\tme: Person\n\t\t\tonlineUsers: [Person]\n\t\t",mutation:"\n\t\t",resolvers:{Query:{me:"me",onlineUsers:"onlineUsers"}}}}},function(e,t,n){"use strict";n(0),n(1),n(4);e.exports=function(e,t){e.get("/",(function(e,t){null!=e.user?t.render("main",{user:e.user}):t.render("index")})),n(161)(e,t),n(162)(e,t),n(163)(e,t),n(8).registerRoutes(e,t),n(164)(e,t),n(166)(e,t)}},function(e,t,n){"use strict";n(0),n(1);e.exports=function(e,t){e.get("/health",(function(e,t){t.sendStatus(200)}))}},function(e,t,n){"use strict";var r=n(0),o=n(1),i=n(5),s=n(13),a=n(22),c=n(48),u=(n(6),n(20),n(14)),l=n(49),d=n(3);function f(){var e={};return r.authKeys&&(r.authKeys.google&&r.authKeys.google.clientID&&(e.google=!0),r.authKeys.facebook&&r.authKeys.facebook.clientID&&(e.facebook=!0),r.authKeys.github&&r.authKeys.github.clientID&&(e.github=!0),r.authKeys.twitter&&r.authKeys.twitter.clientID&&(e.twitter=!0)),Object.keys(e).length>0?e:null}e.exports=function(e,t){e.get("/login",(function(e,t){if(null!=e.user)return t.redirect("/");t.render("account/login",{socialAuth:f()})})),e.get("/logout",(function(e,t){e.logout(),e.session.destroy(),t.redirect("/")})),e.get("/signup",(function(e,t){if(!0===r.features.disableSignUp)return t.redirect("/login");t.render("account/signup",{socialAuth:f()})})),e.post("/signup",(function(e,t){if(!0===r.features.disableSignUp)return t.redirect("/");e.check("name",e.t("NameCannotBeEmpty")).notEmpty(),e.check("email",e.t("EmailCannotBeEmpty")).notEmpty(),e.check("email",e.t("EmailIsNotValid")).isEmail(),e.sanitize("email").normalizeEmail({remove_dots:!1}),e.body.username||(e.body.username=e.body.email),e.sanitize("passwordless").toBoolean();var n=!0===e.body.passwordless;n||(e.check("password",e.t("PasswordCannotBeEmpty")).notEmpty(),e.check("password",e.t("PasswordTooShort")).len(6));var s=e.validationErrors();if(s)return e.flash("error",s),t.redirect("/signup");c.waterfall([function(e){r.features.verificationRequired?a.randomBytes(25,(function(t,n){e(t,t?null:n.toString("hex"))})):e(null,null)},function(t,r){n?a.randomBytes(25,(function(e,n){r(e,t,e?null:n.toString("hex"))})):r(null,t,e.body.password)},function(t,o,s){var a=new d({fullName:e.body.name,email:e.body.email,username:e.body.username,password:o,passwordLess:n,roles:[i.ROLE_USER],provider:"local"});t&&r.mailer.enabled?(a.verified=!1,a.verifyToken=t):a.verified=!0,a.save((function(t,n){if(t&&11e3===t.code){var r=void 0;if(t.message.includes(".$"))r=t.message.split(".$")[1];else{if(!t.message.includes("index: "))return e.flash("error",{msg:e.t("UserSaveError")}),void s(t,n);r=t.message.split("index: ")[1]}"email"==(r=(r=r.split(" dup key")[0]).substring(0,r.lastIndexOf("_")))?e.flash("error",{msg:e.t("EmailIsExists")}):e.flash("error",{msg:e.t("UsernameIsExists")})}s(t,n)}))},function(n,i){if(!r.mailer.enabled)return o.error("config.mailer not enabled; emailing skipped. Have you configured mailer yet?"),i(null,n);if(n.verified){var s=e.t("mailSubjectWelcome",r);t.render("mail/welcome",{name:n.fullName},(function(e,t){if(e)return i(e);l.send(n.email,s,t,(function(e,t){i(null,n)}))}))}else{var a=e.t("mailSubjectActivate",r);t.render("mail/accountVerify",{name:n.fullName,validateLink:"http://"+e.headers.host+"/verify/"+n.verifyToken},(function(t,r){if(t)return i(t);l.send(n.email,a,r,(function(t,r){t?e.flash("error",{msg:e.t("UnableToSendEmail",n)}):e.flash("info",{msg:e.t("emailSentVerifyLink")}),i(t,n)}))}))}}],(function(n,r){if(n)return o.error(n),t.redirect("back");r.verified?e.login(r,(function(e){return e&&o.error(e),t.redirect("/")})):t.redirect("/login")}))})),e.get("/verify/:token",(function(e,t){if(e.isAuthenticated())return t.redirect("/");c.waterfall([function(t){d.findOne({verifyToken:e.params.token}).exec((function(n,r){return n?t(n):r?(r.verified=!0,r.verifyToken=void 0,r.lastLogin=Date.now(),void r.save((function(n){if(n)return e.flash("error",{msg:e.t("UnableModifyAccountDetails")}),t(n);t(null,r)}))):(e.flash("error",{msg:e.t("AccountVerificationExpired")}),t("Verification is invalid!"))}))},function(n,i){if(!r.mailer.enabled){var s="Trying to send email without config.mailer enabled; emailing skipped. Have you configured mailer yet?";return o.error(s),i(s,n)}var a=e.t("mailSubjectWelcome",r);t.render("mail/welcome",{name:n.fullName},(function(e,t){if(e)return i(e);l.send(n.email,a,t,(function(e,t){i(null,n)}))}))},function(t,n){e.login(t,(function(e){n(e,t)}))}],(function(e){if(e)return o.error(e),t.redirect("/signup");t.redirect("/")}))})),e.get("/passwordless/:token",(function(e,t){if(e.isAuthenticated())return t.redirect("/");c.waterfall([function(t){d.findOne({passwordLessToken:e.params.token}).exec((function(n,r){return n?t(n):r?(r.passwordLessToken=void 0,r.verified||(r.verified=!0,r.verifyToken=void 0),r.lastLogin=Date.now(),void r.save((function(n){if(n)return e.flash("error",{msg:e.t("UnableModifyAccountDetails")}),t(n);t(null,r)}))):(e.flash("error",{msg:e.t("PasswordlessTokenExpired")}),t("Token is invalid!"))}))},function(t,n){e.login(t,(function(e){n(e,t)}))}],(function(e){if(e)return o.error(e),t.redirect("/login");t.redirect("/")}))})),e.get("/forgot",(function(e,t){if(e.isAuthenticated())return t.redirect("/");t.render("account/forgot")})),e.post("/forgot",(function(e,t){e.check("email",e.t("EmailIsNotValid")).isEmail(),e.check("email",e.t("EmailCannotBeEmpty")).notEmpty(),e.sanitize("email").normalizeEmail({remove_dots:!1});var n=e.validationErrors();if(n)return e.flash("error",n),t.redirect("back");c.waterfall([function(e){a.randomBytes(25,(function(t,n){e(t,t?null:n.toString("hex"))}))},function(t,n){d.findOne({email:e.body.email},(function(r,o){return o?1!==o.status?(e.flash("error",{msg:e.t("UserDisabledOrDeleted")}),n(e.t("UserDisabledOrDeleted"))):(o.resetPasswordToken=t,o.resetPasswordExpires=Date.now()+36e5,void o.save((function(e){n(e,t,o)}))):(e.flash("error",{msg:e.t("EmailNotAssociatedToAccount",e.body)}),n("Email address "+e.body.email+" is not registered!"))}))},function(n,i,s){if(!r.mailer.enabled){var a="Trying to send email without config.mailer enabled; emailing skipped. Have you configured mailer yet?";return o.error(a),s(a,i)}var c=e.t("mailSubjectResetPassword",r);t.render("mail/passwordReset",{name:i.fullName,resetLink:"http://"+e.headers.host+"/reset/"+n},(function(t,n){if(t)return s(t);l.send(i.email,c,n,(function(t,n){t?e.flash("error",{msg:e.t("UnableToSendEmail",i)}):e.flash("info",{msg:e.t("emailSentPasswordResetLink",i)}),s(t)}))}))}],(function(e){e&&o.error(e),t.redirect("back")}))})),e.get("/reset/:token",(function(e,t,n){if(e.isAuthenticated())return t.redirect("/");d.findOne({resetPasswordToken:e.params.token}).where("resetPasswordExpires").gt(Date.now()).exec((function(r,o){return r?n(r):o?void t.render("account/reset"):(e.flash("error",{msg:e.t("PasswordResetTokenExpired")}),t.redirect("/forgot"))}))})),e.post("/reset/:token",(function(e,t,n){e.check("password",e.t("PasswordTooShort")).len(6),e.check("confirm",e.t("PasswordNotMatched")).equals(e.body.password);var i=e.validationErrors();if(i)return e.flash("error",i),t.redirect("back");c.waterfall([function(t){d.findOne({resetPasswordToken:e.params.token}).where("resetPasswordExpires").gt(Date.now()).exec((function(n,r){return n?t(n):r?(r.passwordLess&&(r.passwordLess=!1),r.password=e.body.password,r.resetPasswordToken=void 0,r.resetPasswordExpires=void 0,r.lastLogin=Date.now(),void r.save((function(n){if(n)return t(n);e.login(r,(function(e){t(e,r)}))}))):(e.flash("error",{msg:e.t("PasswordResetTokenExpired")}),t("Password reset token is invalid or has expired."))}))},function(n,i){if(!r.mailer.enabled){var s="Trying to send email without config.mailer enabled; emailing skipped. Have you configured mailer yet?";return o.error(s),i(s,n)}var a=e.t("mailSubjectPasswordChanged",r);t.render("mail/passwordChange",{name:n.fullName},(function(t,r){if(t)return i(t);l.send(n.email,a,r,(function(t,r){t?e.flash("error",{msg:e.t("UnableToSendEmail",n)}):e.flash("info",{msg:e.t("PasswordChanged")}),i(t)}))}))}],(function(e){if(e)return o.error(e),t.redirect("back");t.redirect("/")}))})),e.get("/generateAPIKey",(function(e,t){if(!e.isAuthenticated())return u.json(t,null,u.UNAUTHORIZED);d.findById(e.user.id).exec((function(n,r){return n?u.json(t,null,u.SERVER_ERROR):r?(r.apiKey=s(),void r.save((function(e){return e?u.json(t,null,u.SERVER_ERROR):u.json(t,r)}))):u.json(t,null,u.NOT_FOUND,e.t("InvalidUser"))}))})),e.get("/unlink/:provider",(function(e,t){return e.isAuthenticated()?e.params.provider&&-1!==["facebook","twitter","google","github"].indexOf(e.params.provider)?void d.findById(e.user.id).exec((function(n,r){return n?u.json(t,null,u.SERVER_ERROR):r?(r.socialLinks[e.params.provider]=void 0,void r.save((function(e){return e?u.json(t,null,u.SERVER_ERROR):u.json(t,r)}))):u.json(t,null,u.NOT_FOUND,e.t("InvalidUser"))})):u.json(t,null,u.BAD_REQUEST,e.t("InvalidOAuthProvider")):u.json(t,null,u.UNAUTHORIZED)}))}},function(e,t,n){"use strict";var r=n(0),o=n(1),i=n(22),s=n(48),a=n(6),c=n(20),u=n(49),l=n(3),d=n(14);function f(e,t,n,r){if(e.accepts("json")&&!e.accepts("html")){var o=e.flash();if(o&&o.error&&o.error.length>0){var i=o.error[0].msg;d.json(t,null,r||d.REQUEST_FAILED,i)}else{var s="OK";o&&o.info&&o.info.length>0&&(s=o.info[0].msg),d.json(t,s)}}else n&&(e.session.returnTo&&(n=e.session.returnTo,delete e.session.returnTo),t.redirect(n))}e.exports=function(e,t){var n=c.Router();n.post("/local",(function(e,t,n){e.assert("username",e.t("UsernameCannotBeEmpty")).notEmpty();var c=e.validationErrors();if(c)return e.flash("error",c),f(e,t,"/login",d.BAD_REQUEST);e.body.password?a.authenticate("local",(function(n,r,o){if(!r)return e.flash("error",{msg:o.message}),f(e,t,"/login");e.login(r,(function(n){if(n)return e.flash("error",{msg:n}),f(e,t,"/login");e.user.lastLogin=Date.now(),e.user.save((function(){e.user.password=void 0,e.user.salt=void 0,f(e,t,"/")}))}))}))(e,t,n):s.waterfall([function(e){i.randomBytes(25,(function(t,n){e(t,t?null:n.toString("hex"))}))},function(t,n){var r=e.body.username;l.findOne({$or:[{username:r},{email:r}]},(function(o,i){return i?1!==i.status?(e.flash("error",{msg:e.t("UserDisabledOrDeleted")}),n("User '"+r+" is disabled or deleted!")):(i.passwordLessToken=t,void i.save((function(e){n(e,t,i)}))):(e.flash("error",{msg:e.t("UsernameIsNotAssociated",{username:r})}),n("Invalid username or email: "+r))}))},function(n,i,s){if(!r.mailer.enabled){var a="Trying to send email without config.mailer not enabled; emailing skipped. Have you configured mailer yet?";return o.error(a),s(a,i)}var c=e.t("mailSubjectLogin",r);t.render("mail/passwordLessLogin",{name:i.fullName,loginLink:"http://"+e.headers.host+"/passwordless/"+n},(function(t,n){if(t)return s(t);u.send(i.email,c,n,(function(t,n){t?e.flash("error",{msg:e.t("UnableToSendEmail",i)}):e.flash("info",{msg:e.t("emailSentWithMagicLink",i)}),s(t)}))}))}],(function(n,r){n&&o.error(n),f(e,t,"back")}))})),n.get("/google",a.authenticate("google",{scope:"profile email"})),n.get("/google/callback",a.authenticate("google",{failureRedirect:"/login"}),(function(e,t){t.redirect("/")})),n.get("/facebook",a.authenticate("facebook",{scope:["email","user_location"]})),n.get("/facebook/callback",a.authenticate("facebook",{failureRedirect:"/login"}),(function(e,t){t.redirect("/")})),n.get("/twitter",a.authenticate("twitter")),n.get("/twitter/callback",a.authenticate("twitter",{failureRedirect:"/login"}),(function(e,t){t.redirect("/")})),n.get("/github",a.authenticate("github",{scope:"user:email"})),n.get("/github/callback",a.authenticate("github",{failureRedirect:"/login"}),(function(e,t){t.redirect("/")})),e.use("/auth",n)}},function(e,t,n){"use strict";var r=n(0),o=n(1),i=(n(12),n(50).graphqlExpress),s=n(50).graphiqlExpress,a=n(165);e.exports=function(e,t){var c=n(8).registerGraphQLSchema();if(c){var u=a.makeExecutableSchema({typeDefs:c.schema,resolvers:c.resolvers,logger:r.isDevMode()?o:void 0});e.use("/graphql",i((function(e){var t=e.query.query||e.body.query;if(t&&t.length>2e3)throw new Error("Query too large.");return{schema:u,context:{req:e,query:t,t:e.t,user:e.user,session:e.session},debug:r.isDevMode(),formatError:function(e){return{status:e.originalError?e.originalError.status:400,type:e.originalError?e.originalError.type:null,message:e.message,locations:e.locations,path:e.path}}}}))),e.use("/graphiql",s({endpointURL:"/graphql"}))}}},function(e,t){e.exports=require("graphql-tools")},function(e,t,n){"use strict";var r=n(0),o=n(1),i=n(14);e.exports=function(e,t){e.use((function(e,t,n,r){return e?(o.error(e.stack),n.status(e.status||500),t.accepts("html")?n.render("500",{url:t.originalUrl,error:e}):t.accepts("json")?i.json(n,null,i.SERVER_ERROR,e.message):void 0):r()})),e.use((function(e,t){if(t.status(404),r.isTestMode()||o.warn("404 error! URL:",e.url),e.accepts("html")){var n=new Error("404 Page Not Found");return n.status=404,t.render("404",{url:e.originalUrl,error:n})}if(e.accepts("json"))return i.json(t,null,i.NOT_FOUND)}))}},function(e,t){e.exports=require("agenda")},function(e,t,n){"use strict";n(0);var r=n(1),o=n(7),i=n(16),s=n(11),a=n(51),c=function(){if(0===s.connection.readyState)return process.exit(0);s.connection.close((function(){return a.stop((function(){return r.info({}),r.info(o.bold("---------------------[ Server stopped at %s Uptime: %s ]---------------------------"),i().format("YYYY-MM-DD HH:mm:ss.SSS"),i.duration(1e3*process.uptime()).humanize()),process.exit(0)}))}))};process.on("SIGINT",c).on("SIGTERM",c)},function(e,t,n){"use strict";var r=n(170),o=n(171),i=n(172),s=n(1);e.exports=function(){var e=o.Gauge,t=r.totalmem(),n=r.freemem(),a=t-n,c=i(n);s.info("CPU:\t\tArch: "+r.arch()+", Cores: "+r.cpus().length),s.info("Memory:\t\t"+e(a,t,20,.8*t,c+" free")),s.info("OS:\t\t"+r.platform()+" ("+r.type()+")")}},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("clui")},function(e,t){e.exports=require("pretty-bytes")},function(e,t,n){"use strict";function r(e,t){for(var n=/\r\n|[\n\r]/g,r=1,o=t+1,i=void 0;(i=n.exec(e.body))&&i.index<t;)r+=1,o=t+1-(i.index+i[0].length);return{line:r,column:o}}n.r(t),n.d(t,"getLocation",(function(){return r})),n.d(t,"Kind",(function(){return o})),n.d(t,"createLexer",(function(){return m})),n.d(t,"TokenKind",(function(){return g})),n.d(t,"parse",(function(){return x})),n.d(t,"parseValue",(function(){return _})),n.d(t,"parseType",(function(){return R})),n.d(t,"print",(function(){return Re})),n.d(t,"Source",(function(){return I})),n.d(t,"visit",(function(){return Ne})),n.d(t,"visitInParallel",(function(){return Te})),n.d(t,"visitWithTypeInfo",(function(){return xe})),n.d(t,"getVisitFn",(function(){return _e})),n.d(t,"BREAK",(function(){return Oe})),n.d(t,"DirectiveLocation",(function(){return T}));var o=Object.freeze({NAME:"Name",DOCUMENT:"Document",OPERATION_DEFINITION:"OperationDefinition",VARIABLE_DEFINITION:"VariableDefinition",VARIABLE:"Variable",SELECTION_SET:"SelectionSet",FIELD:"Field",ARGUMENT:"Argument",FRAGMENT_SPREAD:"FragmentSpread",INLINE_FRAGMENT:"InlineFragment",FRAGMENT_DEFINITION:"FragmentDefinition",INT:"IntValue",FLOAT:"FloatValue",STRING:"StringValue",BOOLEAN:"BooleanValue",NULL:"NullValue",ENUM:"EnumValue",LIST:"ListValue",OBJECT:"ObjectValue",OBJECT_FIELD:"ObjectField",DIRECTIVE:"Directive",NAMED_TYPE:"NamedType",LIST_TYPE:"ListType",NON_NULL_TYPE:"NonNullType",SCHEMA_DEFINITION:"SchemaDefinition",OPERATION_TYPE_DEFINITION:"OperationTypeDefinition",SCALAR_TYPE_DEFINITION:"ScalarTypeDefinition",OBJECT_TYPE_DEFINITION:"ObjectTypeDefinition",FIELD_DEFINITION:"FieldDefinition",INPUT_VALUE_DEFINITION:"InputValueDefinition",INTERFACE_TYPE_DEFINITION:"InterfaceTypeDefinition",UNION_TYPE_DEFINITION:"UnionTypeDefinition",ENUM_TYPE_DEFINITION:"EnumTypeDefinition",ENUM_VALUE_DEFINITION:"EnumValueDefinition",INPUT_OBJECT_TYPE_DEFINITION:"InputObjectTypeDefinition",SCALAR_TYPE_EXTENSION:"ScalarTypeExtension",OBJECT_TYPE_EXTENSION:"ObjectTypeExtension",INTERFACE_TYPE_EXTENSION:"InterfaceTypeExtension",UNION_TYPE_EXTENSION:"UnionTypeExtension",ENUM_TYPE_EXTENSION:"EnumTypeExtension",INPUT_OBJECT_TYPE_EXTENSION:"InputObjectTypeExtension",DIRECTIVE_DEFINITION:"DirectiveDefinition"});function i(e,t){var n=t.line,r=e.locationOffset.line-1,o=function(e,t){return 1===t.line?e.locationOffset.column-1:0}(e,t),i=n+r,c=t.column+o,u=(i-1).toString(),l=i.toString(),d=(i+1).toString(),f=d.length,p=e.body.split(/\r\n|[\n\r]/g);return p[0]=s(e.locationOffset.column-1)+p[0],[e.name+" ("+i+":"+c+")",n>=2&&a(f,u)+": "+p[n-2],a(f,l)+": "+p[n-1],s(2+f+c-1)+"^",n<p.length&&a(f,d)+": "+p[n]].filter(Boolean).join("\n")}function s(e){return Array(e+1).join(" ")}function a(e,t){return s(e-t.length)+t}function c(e,t,n,o,i,s,a){var u=Array.isArray(t)?0!==t.length?t:void 0:t?[t]:void 0,l=n;if(!l&&u){var d=u[0];l=d&&d.loc&&d.loc.source}var f=o;!f&&u&&(f=u.reduce((function(e,t){return t.loc&&e.push(t.loc.start),e}),[])),f&&0===f.length&&(f=void 0);var p=void 0;o&&n?p=o.map((function(e){return r(n,e)})):u&&(p=u.reduce((function(e,t){return t.loc&&e.push(r(t.loc.source,t.loc.start)),e}),[])),Object.defineProperties(this,{message:{value:e,enumerable:!0,writable:!0},locations:{value:p||void 0,enumerable:!0},path:{value:i||void 0,enumerable:!0},nodes:{value:u||void 0},source:{value:l||void 0},positions:{value:f||void 0},originalError:{value:s},extensions:{value:a||s&&s.extensions}}),s&&s.stack?Object.defineProperty(this,"stack",{value:s.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,c):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}function u(e,t,n){return new c("Syntax Error: "+n,void 0,e,[t])}function l(e,t){if(!e)throw new Error(t)}c.prototype=Object.create(Error.prototype,{constructor:{value:c},name:{value:"GraphQLError"},toString:{value:function(){return function(e){var t=[];if(e.nodes)e.nodes.forEach((function(e){e.loc&&t.push(i(e.loc.source,r(e.loc.source,e.loc.start)))}));else if(e.source&&e.locations){var n=e.source;e.locations.forEach((function(e){t.push(i(n,e))}))}return 0===t.length?e.message:[e.message].concat(t).join("\n\n")+"\n"}(this)}}});Object.assign;function d(e){for(var t=e.split(/\r\n|[\n\r]/g),n=null,r=1;r<t.length;r++){var o=t[r],i=f(o);if(i<o.length&&(null===n||i<n)&&0===(n=i))break}if(n)for(var s=1;s<t.length;s++)t[s]=t[s].slice(n);for(;t.length>0&&p(t[0]);)t.shift();for(;t.length>0&&p(t[t.length-1]);)t.pop();return t.join("\n")}function f(e){for(var t=0;t<e.length&&(" "===e[t]||"\t"===e[t]);)t++;return t}function p(e){return f(e)===e.length}function m(e,t){var n=new k(g.SOF,0,0,0,0,null);return{source:e,options:t,lastToken:n,token:n,line:1,lineStart:0,advance:v,lookahead:h}}function v(){return this.lastToken=this.token,this.token=this.lookahead()}function h(){var e=this.token;if(e.kind!==g.EOF)do{e=e.next||(e.next=S(this,e))}while(e.kind===g.COMMENT);return e}var g=Object.freeze({SOF:"<SOF>",EOF:"<EOF>",BANG:"!",DOLLAR:"$",AMP:"&",PAREN_L:"(",PAREN_R:")",SPREAD:"...",COLON:":",EQUALS:"=",AT:"@",BRACKET_L:"[",BRACKET_R:"]",BRACE_L:"{",PIPE:"|",BRACE_R:"}",NAME:"Name",INT:"Int",FLOAT:"Float",STRING:"String",BLOCK_STRING:"BlockString",COMMENT:"Comment"});function y(e){var t=e.value;return t?e.kind+' "'+t+'"':e.kind}var E=String.prototype.charCodeAt,b=String.prototype.slice;function k(e,t,n,r,o,i,s){this.kind=e,this.start=t,this.end=n,this.line=r,this.column=o,this.value=s,this.prev=i,this.next=null}function w(e){return isNaN(e)?g.EOF:e<127?JSON.stringify(String.fromCharCode(e)):'"\\u'+("00"+e.toString(16).toUpperCase()).slice(-4)+'"'}function S(e,t){var n=e.source,r=n.body,o=r.length,i=function(e,t,n){var r=e.length,o=t;for(;o<r;){var i=E.call(e,o);if(9===i||32===i||44===i||65279===i)++o;else if(10===i)++o,++n.line,n.lineStart=o;else{if(13!==i)break;10===E.call(e,o+1)?o+=2:++o,++n.line,n.lineStart=o}}return o}(r,t.end,e),s=e.line,a=1+i-e.lineStart;if(i>=o)return new k(g.EOF,o,o,s,a,t);var c=E.call(r,i);if(c<32&&9!==c&&10!==c&&13!==c)throw u(n,i,"Cannot contain the invalid character "+w(c)+".");switch(c){case 33:return new k(g.BANG,i,i+1,s,a,t);case 35:return function(e,t,n,r,o){var i=e.body,s=void 0,a=t;do{s=E.call(i,++a)}while(null!==s&&(s>31||9===s));return new k(g.COMMENT,t,a,n,r,o,b.call(i,t+1,a))}(n,i,s,a,t);case 36:return new k(g.DOLLAR,i,i+1,s,a,t);case 38:return new k(g.AMP,i,i+1,s,a,t);case 40:return new k(g.PAREN_L,i,i+1,s,a,t);case 41:return new k(g.PAREN_R,i,i+1,s,a,t);case 46:if(46===E.call(r,i+1)&&46===E.call(r,i+2))return new k(g.SPREAD,i,i+3,s,a,t);break;case 58:return new k(g.COLON,i,i+1,s,a,t);case 61:return new k(g.EQUALS,i,i+1,s,a,t);case 64:return new k(g.AT,i,i+1,s,a,t);case 91:return new k(g.BRACKET_L,i,i+1,s,a,t);case 93:return new k(g.BRACKET_R,i,i+1,s,a,t);case 123:return new k(g.BRACE_L,i,i+1,s,a,t);case 124:return new k(g.PIPE,i,i+1,s,a,t);case 125:return new k(g.BRACE_R,i,i+1,s,a,t);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return function(e,t,n,r,o){var i=e.body,s=i.length,a=t+1,c=0;for(;a!==s&&null!==(c=E.call(i,a))&&(95===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122);)++a;return new k(g.NAME,t,a,n,r,o,b.call(i,t,a))}(n,i,s,a,t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return function(e,t,n,r,o,i){var s=e.body,a=n,c=t,l=!1;45===a&&(a=E.call(s,++c));if(48===a){if((a=E.call(s,++c))>=48&&a<=57)throw u(e,c,"Invalid number, unexpected digit after 0: "+w(a)+".")}else c=O(e,c,a),a=E.call(s,c);46===a&&(l=!0,a=E.call(s,++c),c=O(e,c,a),a=E.call(s,c));69!==a&&101!==a||(l=!0,43!==(a=E.call(s,++c))&&45!==a||(a=E.call(s,++c)),c=O(e,c,a));return new k(l?g.FLOAT:g.INT,t,c,r,o,i,b.call(s,t,c))}(n,i,c,s,a,t);case 34:return 34===E.call(r,i+1)&&34===E.call(r,i+2)?function(e,t,n,r,o){var i=e.body,s=t+3,a=s,c=0,l="";for(;s<i.length&&null!==(c=E.call(i,s));){if(34===c&&34===E.call(i,s+1)&&34===E.call(i,s+2))return l+=b.call(i,a,s),new k(g.BLOCK_STRING,t,s+3,n,r,o,d(l));if(c<32&&9!==c&&10!==c&&13!==c)throw u(e,s,"Invalid character within String: "+w(c)+".");92===c&&34===E.call(i,s+1)&&34===E.call(i,s+2)&&34===E.call(i,s+3)?(l+=b.call(i,a,s)+'"""',a=s+=4):++s}throw u(e,s,"Unterminated string.")}(n,i,s,a,t):function(e,t,n,r,o){var i=e.body,s=t+1,a=s,c=0,l="";for(;s<i.length&&null!==(c=E.call(i,s))&&10!==c&&13!==c;){if(34===c)return l+=b.call(i,a,s),new k(g.STRING,t,s+1,n,r,o,l);if(c<32&&9!==c)throw u(e,s,"Invalid character within String: "+w(c)+".");if(++s,92===c){switch(l+=b.call(i,a,s-1),c=E.call(i,s)){case 34:l+='"';break;case 47:l+="/";break;case 92:l+="\\";break;case 98:l+="\b";break;case 102:l+="\f";break;case 110:l+="\n";break;case 114:l+="\r";break;case 116:l+="\t";break;case 117:var d=(f=E.call(i,s+1),p=E.call(i,s+2),m=E.call(i,s+3),v=E.call(i,s+4),N(f)<<12|N(p)<<8|N(m)<<4|N(v));if(d<0)throw u(e,s,"Invalid character escape sequence: \\u"+i.slice(s+1,s+5)+".");l+=String.fromCharCode(d),s+=4;break;default:throw u(e,s,"Invalid character escape sequence: \\"+String.fromCharCode(c)+".")}++s,a=s}}var f,p,m,v;throw u(e,s,"Unterminated string.")}(n,i,s,a,t)}throw u(n,i,function(e){if(39===e)return"Unexpected single quote character ('), did you mean to use a double quote (\")?";return"Cannot parse the unexpected character "+w(e)+"."}(c))}function O(e,t,n){var r=e.body,o=t,i=n;if(i>=48&&i<=57){do{i=E.call(r,++o)}while(i>=48&&i<=57);return o}throw u(e,o,"Invalid number, expected digit but got: "+w(i)+".")}function N(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}k.prototype.toJSON=k.prototype.inspect=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}};var I=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.body=t,this.name=n||"GraphQL request",this.locationOffset=r||{line:1,column:1},this.locationOffset.line>0||l(0,"line in locationOffset is 1-indexed and must be positive"),this.locationOffset.column>0||l(0,"column in locationOffset is 1-indexed and must be positive")},T=Object.freeze({QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"});function x(e,t){var n="string"==typeof e?new I(e):e;if(!(n instanceof I))throw new TypeError("Must provide Source. Received: "+String(n));return function(e){var t=e.token;ye(e,g.SOF);var n=[];do{n.push(P(e))}while(!ge(e,g.EOF));return{kind:o.DOCUMENT,definitions:n,loc:me(e,t)}}(m(n,t||{}))}function _(e,t){var n=m("string"==typeof e?new I(e):e,t||{});ye(n,g.SOF);var r=G(n,!1);return ye(n,g.EOF),r}function R(e,t){var n=m("string"==typeof e?new I(e):e,t||{});ye(n,g.SOF);var r=X(n);return ye(n,g.EOF),r}function D(e){var t=ye(e,g.NAME);return{kind:o.NAME,value:t.value,loc:me(e,t)}}function P(e){if(he(e,g.NAME))switch(e.token.value){case"query":case"mutation":case"subscription":case"fragment":return A(e);case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"extend":case"directive":return ee(e)}else{if(he(e,g.BRACE_L))return A(e);if(te(e))return ee(e)}throw be(e)}function A(e){if(he(e,g.NAME))switch(e.token.value){case"query":case"mutation":case"subscription":return L(e);case"fragment":return function(e){var t=e.token;if(Ee(e,"fragment"),e.options.experimentalFragmentVariables)return{kind:o.FRAGMENT_DEFINITION,name:z(e),variableDefinitions:C(e),typeCondition:(Ee(e,"on"),Z(e)),directives:H(e,!1),selectionSet:U(e),loc:me(e,t)};return{kind:o.FRAGMENT_DEFINITION,name:z(e),typeCondition:(Ee(e,"on"),Z(e)),directives:H(e,!1),selectionSet:U(e),loc:me(e,t)}}(e)}else if(he(e,g.BRACE_L))return L(e);throw be(e)}function L(e){var t=e.token;if(he(e,g.BRACE_L))return{kind:o.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:U(e),loc:me(e,t)};var n=q(e),r=void 0;return he(e,g.NAME)&&(r=D(e)),{kind:o.OPERATION_DEFINITION,operation:n,name:r,variableDefinitions:C(e),directives:H(e,!1),selectionSet:U(e),loc:me(e,t)}}function q(e){var t=ye(e,g.NAME);switch(t.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw be(e,t)}function C(e){return he(e,g.PAREN_L)?we(e,g.PAREN_L,M,g.PAREN_R):[]}function M(e){var t=e.token;return{kind:o.VARIABLE_DEFINITION,variable:j(e),type:(ye(e,g.COLON),X(e)),defaultValue:ge(e,g.EQUALS)?G(e,!0):void 0,loc:me(e,t)}}function j(e){var t=e.token;return ye(e,g.DOLLAR),{kind:o.VARIABLE,name:D(e),loc:me(e,t)}}function U(e){var t=e.token;return{kind:o.SELECTION_SET,selections:we(e,g.BRACE_L,F,g.BRACE_R),loc:me(e,t)}}function F(e){return he(e,g.SPREAD)?function(e){var t=e.token;if(ye(e,g.SPREAD),he(e,g.NAME)&&"on"!==e.token.value)return{kind:o.FRAGMENT_SPREAD,name:z(e),directives:H(e,!1),loc:me(e,t)};var n=void 0;"on"===e.token.value&&(e.advance(),n=Z(e));return{kind:o.INLINE_FRAGMENT,typeCondition:n,directives:H(e,!1),selectionSet:U(e),loc:me(e,t)}}(e):function(e){var t=e.token,n=D(e),r=void 0,i=void 0;ge(e,g.COLON)?(r=n,i=D(e)):i=n;return{kind:o.FIELD,alias:r,name:i,arguments:$(e,!1),directives:H(e,!1),selectionSet:he(e,g.BRACE_L)?U(e):void 0,loc:me(e,t)}}(e)}function $(e,t){var n=t?V:B;return he(e,g.PAREN_L)?we(e,g.PAREN_L,n,g.PAREN_R):[]}function B(e){var t=e.token;return{kind:o.ARGUMENT,name:D(e),value:(ye(e,g.COLON),G(e,!1)),loc:me(e,t)}}function V(e){var t=e.token;return{kind:o.ARGUMENT,name:D(e),value:(ye(e,g.COLON),J(e)),loc:me(e,t)}}function z(e){if("on"===e.token.value)throw be(e);return D(e)}function G(e,t){var n=e.token;switch(n.kind){case g.BRACKET_L:return function(e,t){var n=e.token,r=t?J:Q;return{kind:o.LIST,values:ke(e,g.BRACKET_L,r,g.BRACKET_R),loc:me(e,n)}}(e,t);case g.BRACE_L:return function(e,t){var n=e.token;ye(e,g.BRACE_L);var r=[];for(;!ge(e,g.BRACE_R);)r.push(Y(e,t));return{kind:o.OBJECT,fields:r,loc:me(e,n)}}(e,t);case g.INT:return e.advance(),{kind:o.INT,value:n.value,loc:me(e,n)};case g.FLOAT:return e.advance(),{kind:o.FLOAT,value:n.value,loc:me(e,n)};case g.STRING:case g.BLOCK_STRING:return K(e);case g.NAME:return"true"===n.value||"false"===n.value?(e.advance(),{kind:o.BOOLEAN,value:"true"===n.value,loc:me(e,n)}):"null"===n.value?(e.advance(),{kind:o.NULL,loc:me(e,n)}):(e.advance(),{kind:o.ENUM,value:n.value,loc:me(e,n)});case g.DOLLAR:if(!t)return j(e)}throw be(e)}function K(e){var t=e.token;return e.advance(),{kind:o.STRING,value:t.value,block:t.kind===g.BLOCK_STRING,loc:me(e,t)}}function J(e){return G(e,!0)}function Q(e){return G(e,!1)}function Y(e,t){var n=e.token;return{kind:o.OBJECT_FIELD,name:D(e),value:(ye(e,g.COLON),G(e,t)),loc:me(e,n)}}function H(e,t){for(var n=[];he(e,g.AT);)n.push(W(e,t));return n}function W(e,t){var n=e.token;return ye(e,g.AT),{kind:o.DIRECTIVE,name:D(e),arguments:$(e,t),loc:me(e,n)}}function X(e){var t=e.token,n=void 0;return ge(e,g.BRACKET_L)?(n=X(e),ye(e,g.BRACKET_R),n={kind:o.LIST_TYPE,type:n,loc:me(e,t)}):n=Z(e),ge(e,g.BANG)?{kind:o.NON_NULL_TYPE,type:n,loc:me(e,t)}:n}function Z(e){var t=e.token;return{kind:o.NAMED_TYPE,name:D(e),loc:me(e,t)}}function ee(e){var t=te(e)?e.lookahead():e.token;if(t.kind===g.NAME)switch(t.value){case"schema":return function(e){var t=e.token;Ee(e,"schema");var n=H(e,!0),r=we(e,g.BRACE_L,re,g.BRACE_R);return{kind:o.SCHEMA_DEFINITION,directives:n,operationTypes:r,loc:me(e,t)}}(e);case"scalar":return function(e){var t=e.token,n=ne(e);Ee(e,"scalar");var r=D(e),i=H(e,!0);return{kind:o.SCALAR_TYPE_DEFINITION,description:n,name:r,directives:i,loc:me(e,t)}}(e);case"type":return function(e){var t=e.token,n=ne(e);Ee(e,"type");var r=D(e),i=oe(e),s=H(e,!0),a=ie(e);return{kind:o.OBJECT_TYPE_DEFINITION,description:n,name:r,interfaces:i,directives:s,fields:a,loc:me(e,t)}}(e);case"interface":return function(e){var t=e.token,n=ne(e);Ee(e,"interface");var r=D(e),i=H(e,!0),s=ie(e);return{kind:o.INTERFACE_TYPE_DEFINITION,description:n,name:r,directives:i,fields:s,loc:me(e,t)}}(e);case"union":return function(e){var t=e.token,n=ne(e);Ee(e,"union");var r=D(e),i=H(e,!0),s=ue(e);return{kind:o.UNION_TYPE_DEFINITION,description:n,name:r,directives:i,types:s,loc:me(e,t)}}(e);case"enum":return function(e){var t=e.token,n=ne(e);Ee(e,"enum");var r=D(e),i=H(e,!0),s=le(e);return{kind:o.ENUM_TYPE_DEFINITION,description:n,name:r,directives:i,values:s,loc:me(e,t)}}(e);case"input":return function(e){var t=e.token,n=ne(e);Ee(e,"input");var r=D(e),i=H(e,!0),s=fe(e);return{kind:o.INPUT_OBJECT_TYPE_DEFINITION,description:n,name:r,directives:i,fields:s,loc:me(e,t)}}(e);case"extend":return function(e){var t=e.lookahead();if(t.kind===g.NAME)switch(t.value){case"scalar":return function(e){var t=e.token;Ee(e,"extend"),Ee(e,"scalar");var n=D(e),r=H(e,!0);if(0===r.length)throw be(e);return{kind:o.SCALAR_TYPE_EXTENSION,name:n,directives:r,loc:me(e,t)}}(e);case"type":return function(e){var t=e.token;Ee(e,"extend"),Ee(e,"type");var n=D(e),r=oe(e),i=H(e,!0),s=ie(e);if(0===r.length&&0===i.length&&0===s.length)throw be(e);return{kind:o.OBJECT_TYPE_EXTENSION,name:n,interfaces:r,directives:i,fields:s,loc:me(e,t)}}(e);case"interface":return function(e){var t=e.token;Ee(e,"extend"),Ee(e,"interface");var n=D(e),r=H(e,!0),i=ie(e);if(0===r.length&&0===i.length)throw be(e);return{kind:o.INTERFACE_TYPE_EXTENSION,name:n,directives:r,fields:i,loc:me(e,t)}}(e);case"union":return function(e){var t=e.token;Ee(e,"extend"),Ee(e,"union");var n=D(e),r=H(e,!0),i=ue(e);if(0===r.length&&0===i.length)throw be(e);return{kind:o.UNION_TYPE_EXTENSION,name:n,directives:r,types:i,loc:me(e,t)}}(e);case"enum":return function(e){var t=e.token;Ee(e,"extend"),Ee(e,"enum");var n=D(e),r=H(e,!0),i=le(e);if(0===r.length&&0===i.length)throw be(e);return{kind:o.ENUM_TYPE_EXTENSION,name:n,directives:r,values:i,loc:me(e,t)}}(e);case"input":return function(e){var t=e.token;Ee(e,"extend"),Ee(e,"input");var n=D(e),r=H(e,!0),i=fe(e);if(0===r.length&&0===i.length)throw be(e);return{kind:o.INPUT_OBJECT_TYPE_EXTENSION,name:n,directives:r,fields:i,loc:me(e,t)}}(e)}throw be(e,t)}(e);case"directive":return function(e){var t=e.token,n=ne(e);Ee(e,"directive"),ye(e,g.AT);var r=D(e),i=ae(e);Ee(e,"on");var s=function(e){ge(e,g.PIPE);var t=[];do{t.push(pe(e))}while(ge(e,g.PIPE));return t}(e);return{kind:o.DIRECTIVE_DEFINITION,description:n,name:r,arguments:i,locations:s,loc:me(e,t)}}(e)}throw be(e,t)}function te(e){return he(e,g.STRING)||he(e,g.BLOCK_STRING)}function ne(e){if(te(e))return K(e)}function re(e){var t=e.token,n=q(e);ye(e,g.COLON);var r=Z(e);return{kind:o.OPERATION_TYPE_DEFINITION,operation:n,type:r,loc:me(e,t)}}function oe(e){var t=[];if("implements"===e.token.value){e.advance(),ge(e,g.AMP);do{t.push(Z(e))}while(ge(e,g.AMP)||e.options.allowLegacySDLImplementsInterfaces&&he(e,g.NAME))}return t}function ie(e){return e.options.allowLegacySDLEmptyFields&&he(e,g.BRACE_L)&&e.lookahead().kind===g.BRACE_R?(e.advance(),e.advance(),[]):he(e,g.BRACE_L)?we(e,g.BRACE_L,se,g.BRACE_R):[]}function se(e){var t=e.token,n=ne(e),r=D(e),i=ae(e);ye(e,g.COLON);var s=X(e),a=H(e,!0);return{kind:o.FIELD_DEFINITION,description:n,name:r,arguments:i,type:s,directives:a,loc:me(e,t)}}function ae(e){return he(e,g.PAREN_L)?we(e,g.PAREN_L,ce,g.PAREN_R):[]}function ce(e){var t=e.token,n=ne(e),r=D(e);ye(e,g.COLON);var i=X(e),s=void 0;ge(e,g.EQUALS)&&(s=J(e));var a=H(e,!0);return{kind:o.INPUT_VALUE_DEFINITION,description:n,name:r,type:i,defaultValue:s,directives:a,loc:me(e,t)}}function ue(e){var t=[];if(ge(e,g.EQUALS)){ge(e,g.PIPE);do{t.push(Z(e))}while(ge(e,g.PIPE))}return t}function le(e){return he(e,g.BRACE_L)?we(e,g.BRACE_L,de,g.BRACE_R):[]}function de(e){var t=e.token,n=ne(e),r=D(e),i=H(e,!0);return{kind:o.ENUM_VALUE_DEFINITION,description:n,name:r,directives:i,loc:me(e,t)}}function fe(e){return he(e,g.BRACE_L)?we(e,g.BRACE_L,ce,g.BRACE_R):[]}function pe(e){var t=e.token,n=D(e);if(T.hasOwnProperty(n.value))return n;throw be(e,t)}function me(e,t){if(!e.options.noLocation)return new ve(t,e.lastToken,e.source)}function ve(e,t,n){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=n}function he(e,t){return e.token.kind===t}function ge(e,t){var n=e.token.kind===t;return n&&e.advance(),n}function ye(e,t){var n=e.token;if(n.kind===t)return e.advance(),n;throw u(e.source,n.start,"Expected "+t+", found "+y(n))}function Ee(e,t){var n=e.token;if(n.kind===g.NAME&&n.value===t)return e.advance(),n;throw u(e.source,n.start,'Expected "'+t+'", found '+y(n))}function be(e,t){var n=t||e.token;return u(e.source,n.start,"Unexpected "+y(n))}function ke(e,t,n,r){ye(e,t);for(var o=[];!ge(e,r);)o.push(n(e));return o}function we(e,t,n,r){ye(e,t);for(var o=[n(e)];!ge(e,r);)o.push(n(e));return o}ve.prototype.toJSON=ve.prototype.inspect=function(){return{start:this.start,end:this.end}};var Se={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"]},Oe={};function Ne(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Se,r=void 0,o=Array.isArray(e),i=[e],s=-1,a=[],c=void 0,u=void 0,l=void 0,d=[],f=[],p=e;do{var m=++s===i.length,v=m&&0!==a.length;if(m){if(u=0===f.length?void 0:d[d.length-1],c=l,l=f.pop(),v){if(o)c=c.slice();else{var h={};for(var g in c)c.hasOwnProperty(g)&&(h[g]=c[g]);c=h}for(var y=0,E=0;E<a.length;E++){var b=a[E][0],k=a[E][1];o&&(b-=y),o&&null===k?(c.splice(b,1),y++):c[b]=k}}s=r.index,i=r.keys,a=r.edits,o=r.inArray,r=r.prev}else{if(u=l?o?s:i[s]:void 0,null==(c=l?l[u]:p))continue;l&&d.push(u)}var w=void 0;if(!Array.isArray(c)){if(!Ie(c))throw new Error("Invalid AST Node: "+JSON.stringify(c));var S=_e(t,c.kind,m);if(S){if((w=S.call(t,c,u,l,d,f))===Oe)break;if(!1===w){if(!m){d.pop();continue}}else if(void 0!==w&&(a.push([u,w]),!m)){if(!Ie(w)){d.pop();continue}c=w}}}void 0===w&&v&&a.push([u,c]),m?d.pop():(r={inArray:o,index:s,keys:i,edits:a,prev:r},i=(o=Array.isArray(c))?c:n[c.kind]||[],s=-1,a=[],l&&f.push(l),l=c)}while(void 0!==r);return 0!==a.length&&(p=a[a.length-1][1]),p}function Ie(e){return Boolean(e&&"string"==typeof e.kind)}function Te(e){var t=new Array(e.length);return{enter:function(n){for(var r=0;r<e.length;r++)if(!t[r]){var o=_e(e[r],n.kind,!1);if(o){var i=o.apply(e[r],arguments);if(!1===i)t[r]=n;else if(i===Oe)t[r]=Oe;else if(void 0!==i)return i}}},leave:function(n){for(var r=0;r<e.length;r++)if(t[r])t[r]===n&&(t[r]=null);else{var o=_e(e[r],n.kind,!0);if(o){var i=o.apply(e[r],arguments);if(i===Oe)t[r]=Oe;else if(void 0!==i&&!1!==i)return i}}}}}function xe(e,t){return{enter:function(n){e.enter(n);var r=_e(t,n.kind,!1);if(r){var o=r.apply(t,arguments);return void 0!==o&&(e.leave(n),Ie(o)&&e.enter(o)),o}},leave:function(n){var r=_e(t,n.kind,!0),o=void 0;return r&&(o=r.apply(t,arguments)),e.leave(n),o}}}function _e(e,t,n){var r=e[t];if(r){if(!n&&"function"==typeof r)return r;var o=n?r.leave:r.enter;if("function"==typeof o)return o}else{var i=n?e.leave:e.enter;if(i){if("function"==typeof i)return i;var s=i[t];if("function"==typeof s)return s}}}function Re(e){return Ne(e,{leave:De})}var De={Name:function(e){return e.value},Variable:function(e){return"$"+e.name},Document:function(e){return Ae(e.definitions,"\n\n")+"\n"},OperationDefinition:function(e){var t=e.operation,n=e.name,r=qe("(",Ae(e.variableDefinitions,", "),")"),o=Ae(e.directives," "),i=e.selectionSet;return n||o||r||"query"!==t?Ae([t,Ae([n,r]),o,i]," "):i},VariableDefinition:function(e){return e.variable+": "+e.type+qe(" = ",e.defaultValue)},SelectionSet:function(e){return Le(e.selections)},Field:function(e){var t=e.alias,n=e.name,r=e.arguments,o=e.directives,i=e.selectionSet;return Ae([qe("",t,": ")+n+qe("(",Ae(r,", "),")"),Ae(o," "),i]," ")},Argument:function(e){return e.name+": "+e.value},FragmentSpread:function(e){return"..."+e.name+qe(" ",Ae(e.directives," "))},InlineFragment:function(e){var t=e.typeCondition,n=e.directives,r=e.selectionSet;return Ae(["...",qe("on ",t),Ae(n," "),r]," ")},FragmentDefinition:function(e){var t=e.name,n=e.typeCondition,r=e.variableDefinitions,o=e.directives,i=e.selectionSet;return"fragment "+t+qe("(",Ae(r,", "),")")+" on "+n+" "+qe("",Ae(o," ")," ")+i},IntValue:function(e){return e.value},FloatValue:function(e){return e.value},StringValue:function(e,t){var n=e.value;return e.block?function(e,t){var n=e.replace(/"""/g,'\\"""');return" "!==e[0]&&"\t"!==e[0]||-1!==e.indexOf("\n")?'"""\n'+(t?n:Ce(n))+'\n"""':'"""'+n.replace(/"$/,'"\n')+'"""'}(n,"description"===t):JSON.stringify(n)},BooleanValue:function(e){return e.value?"true":"false"},NullValue:function(){return"null"},EnumValue:function(e){return e.value},ListValue:function(e){return"["+Ae(e.values,", ")+"]"},ObjectValue:function(e){return"{"+Ae(e.fields,", ")+"}"},ObjectField:function(e){return e.name+": "+e.value},Directive:function(e){return"@"+e.name+qe("(",Ae(e.arguments,", "),")")},NamedType:function(e){return e.name},ListType:function(e){return"["+e.type+"]"},NonNullType:function(e){return e.type+"!"},SchemaDefinition:function(e){var t=e.directives,n=e.operationTypes;return Ae(["schema",Ae(t," "),Le(n)]," ")},OperationTypeDefinition:function(e){return e.operation+": "+e.type},ScalarTypeDefinition:Pe((function(e){return Ae(["scalar",e.name,Ae(e.directives," ")]," ")})),ObjectTypeDefinition:Pe((function(e){var t=e.name,n=e.interfaces,r=e.directives,o=e.fields;return Ae(["type",t,qe("implements ",Ae(n," & ")),Ae(r," "),Le(o)]," ")})),FieldDefinition:Pe((function(e){var t=e.name,n=e.arguments,r=e.type,o=e.directives;return t+qe("(",Ae(n,", "),")")+": "+r+qe(" ",Ae(o," "))})),InputValueDefinition:Pe((function(e){var t=e.name,n=e.type,r=e.defaultValue,o=e.directives;return Ae([t+": "+n,qe("= ",r),Ae(o," ")]," ")})),InterfaceTypeDefinition:Pe((function(e){var t=e.name,n=e.directives,r=e.fields;return Ae(["interface",t,Ae(n," "),Le(r)]," ")})),UnionTypeDefinition:Pe((function(e){var t=e.name,n=e.directives,r=e.types;return Ae(["union",t,Ae(n," "),r&&0!==r.length?"= "+Ae(r," | "):""]," ")})),EnumTypeDefinition:Pe((function(e){var t=e.name,n=e.directives,r=e.values;return Ae(["enum",t,Ae(n," "),Le(r)]," ")})),EnumValueDefinition:Pe((function(e){return Ae([e.name,Ae(e.directives," ")]," ")})),InputObjectTypeDefinition:Pe((function(e){var t=e.name,n=e.directives,r=e.fields;return Ae(["input",t,Ae(n," "),Le(r)]," ")})),ScalarTypeExtension:function(e){return Ae(["extend scalar",e.name,Ae(e.directives," ")]," ")},ObjectTypeExtension:function(e){var t=e.name,n=e.interfaces,r=e.directives,o=e.fields;return Ae(["extend type",t,qe("implements ",Ae(n," & ")),Ae(r," "),Le(o)]," ")},InterfaceTypeExtension:function(e){var t=e.name,n=e.directives,r=e.fields;return Ae(["extend interface",t,Ae(n," "),Le(r)]," ")},UnionTypeExtension:function(e){var t=e.name,n=e.directives,r=e.types;return Ae(["extend union",t,Ae(n," "),r&&0!==r.length?"= "+Ae(r," | "):""]," ")},EnumTypeExtension:function(e){var t=e.name,n=e.directives,r=e.values;return Ae(["extend enum",t,Ae(n," "),Le(r)]," ")},InputObjectTypeExtension:function(e){var t=e.name,n=e.directives,r=e.fields;return Ae(["extend input",t,Ae(n," "),Le(r)]," ")},DirectiveDefinition:Pe((function(e){var t=e.name,n=e.arguments,r=e.locations;return"directive @"+t+qe("(",Ae(n,", "),")")+" on "+Ae(r," | ")}))};function Pe(e){return function(t){return Ae([t.description,e(t)],"\n")}}function Ae(e,t){return e?e.filter((function(e){return e})).join(t||""):""}function Le(e){return e&&0!==e.length?"{\n"+Ce(Ae(e,"\n"))+"\n}":""}function qe(e,t,n){return t?e+t+(n||""):""}function Ce(e){return e&&"  "+e.replace(/\n/g,"\n  ")}}]);